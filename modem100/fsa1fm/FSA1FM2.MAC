;  
;   FSA1FM3 -> Source re-created by Z80DIS 2.2
;      Z80DIS was written by Kenneth Gielow
;                            Palo Alto, CA
        .Z80
        ORG	4090H
VDP.DR	EQU	0006H	; ---L-
RDSLT	EQU	000CH	; -C---
CHGMOD	EQU	005FH	; -C---
I$00A2	EQU	00A2H	; ----I
BEEP	EQU	00C0H	; J----
I$012B	EQU	012BH	; ----I
I$02C0	EQU	02C0H	; ----I
I$2121	EQU	2121H	; ----I
I$255E	EQU	255EH	; ----I
I$303B	EQU	303BH	; ----I
C$3A00	EQU	3A00H	; -C---
I$3B32	EQU	3B32H	; ----I

C$6000	EQU	6000H	; -C---
D.615D	EQU	615DH                   ; comterm mode (b0 = interlace, b1 = full, b2 = chinese, b3/b4 = srceen mode, b5/b6 = kanji code, b7 = DEL operation)
D$61A3	EQU	61A3H	; ---L-
D$61A4	EQU	61A4H	; ---L-
D$61A5	EQU	61A5H	; ---L-
D.61A6	EQU	61A6H	; ---L-
D.61AF	EQU	61AFH                   ; resume address
D.61B1	EQU	61B1H                   ; stored HL
D.61B3	EQU	61B3H                   ; first ESC character
D.61B4	EQU	61B4H	; ---LI
D.61C3	EQU	61C3H	; --S-I
D.61C4	EQU	61C4H	; --SL-
D.61C5	EQU	61C5H                   ; english flag
D.61C8	EQU	61C8H	; --SLI
D.61C9	EQU	61C9H	; --SL-
D.61CB	EQU	61CBH	; --SL-
D.61CD	EQU	61CDH	; --SL-
D.61D0	EQU	61D0H	; --SLI
D.61D1	EQU	61D1H	; --SL-
D.61D2	EQU	61D2H	; --SL-
D.61D3	EQU	61D3H
D.61D4	EQU	61D4H
D.61D5	EQU	61D5H
D.61D7	EQU	61D7H                   ; number of rows
D.61D8	EQU	61D8H                   ; number of columns
D.61D9	EQU	61D9H	; --SLI
D.61DA	EQU	61DAH	; --SL-
D.61DB	EQU	61DBH	; ---LI
D.61DC	EQU	61DCH	; --SL-
D.61DD	EQU	61DDH	; --S--
D.61DF	EQU	61DFH	; --S--
D.61E1	EQU	61E1H	; --SL-
D.61E2	EQU	61E2H	; --SL-
D.61E3	EQU	61E3H	; --SLI
D.61E4	EQU	61E4H	; --SL-
D.61E5	EQU	61E5H	; --SL-
D.61E6	EQU	61E6H	; --SL-
D.61E8	EQU	61E8H	; --SL-
D.61E9	EQU	61E9H	; --S--
D.61EA	EQU	61EAH	; --S--
D.61EB	EQU	61EBH	; --SL-
D.61ED	EQU	61EDH	; --SL-
D.61EF	EQU	61EFH	; --SLI
D.61F0	EQU	61F0H	; --SL-
D.61F1	EQU	61F1H	; --SL-
I.61F3	EQU	61F3H	; ----I
I$61F4	EQU	61F4H	; ----I
D.6320	EQU	6320H	; --S-I
D$6321	EQU	6321H	; --S--
I$6328	EQU	6328H	; ----I
D$632C	EQU	632CH	; --S--
D$632D	EQU	632DH	; --S--
D$632E	EQU	632EH	; --S--
D.632F	EQU	632FH	; --S--
D.6330	EQU	6330H	; --S-I
D$6331	EQU	6331H	; --S--
D$633C	EQU	633CH	; --S--
D$633D	EQU	633DH	; --S--
D$633E	EQU	633EH	; --S--
D$633F	EQU	633FH	; --S--
D.6361	EQU	6361H	; ---L-
D$7EEC	EQU	7EECH	; ---L-
D$7EFB	EQU	7EFBH	; ---L-

C$8EA7	EQU	8EA7H	; -C---
I$8F11	EQU	8F11H	; ----I
I.AC11	EQU	0AC11H	; ----I
J$B191	EQU	0B191H	; J----
J$B2DE	EQU	0B2DEH	; J----
C$B7F3	EQU	0B7F3H	; -C---
C$CA00	EQU	0CA00H	; -C---
J$CBC8	EQU	0CBC8H	; J----
C$CD97	EQU	0CD97H	; -C---
I$DEE1	EQU	0DEE1H	; ----I
I$DFE0	EQU	0DFE0H	; ----I

GRPCOL	EQU	0F3C9H	; --S--
GRPCGP	EQU	0F3CBH	; --S--
CSRY	EQU	0F3DCH	; --SLI
CSRX	EQU	0F3DDH	; --SLI
CNSDFG	EQU	0F3DEH	; --SLI
RG0SAV	EQU	0F3DFH	; ----I
FORCLR	EQU	0F3E9H	; --SL-
BAKCLR	EQU	0F3EAH	; --SL-
FNKSTR	EQU	0F87FH	; ----I
CGPNT	EQU	0F91FH	; ---L-
DPPAGE	EQU	0FAF5H	; --SL-
EXBRSA	EQU	0FAF8H	; ---L-
MODE	EQU	0FAFCH	; ---L-
FNKSWI	EQU	0FBCDH	; --SL-
NEWKEY	EQU	0FBE5H	; ---LI
LINWRK	EQU	0FC18H	; ----I
PATWRK	EQU	0FC40H	; ---LI
SCRMOD	EQU	0FCAFH	; --SL-
GRPACX	EQU	0FCB7H	; --SL-
GRPACY	EQU	0FCB9H	; --SLI
EXPTBL	EQU	0FCC1H	; ---L-
RG8SAV	EQU	0FFE7H	; ----I
RG9SAV	EQU	0FFE8H	; ---L-
RG23SAV	EQU	0FFF6H	; ---L-

?.4090:	JP	J$40BA                  ; initialize comterm mode
?.4093:	JP	J$40F0                  ; print to screen/printer
?.4096:	JP	J$40EA                  ; revert to normal graphic screen
?.4099:	JP	J$467A                  ; update function key display
?.409C:	JP	C.421A
?.409F:	JP	J$457F
I$40A2:	JP	J$4676
?.40A5:	JP	C.4596
?.40A8:	JP	C.44CE
?.40AB:	JP	J$48FA
?.40AE:	JP	J$4893
?.40B1:	JP	J$48A8
?.40B4:	JP	J$4817
?.40B7:	JP	J$47F3

;	  Subroutine initialize comterm mode
;	     Inputs  ________________________
;	     Outputs ________________________

J$40BA:	CALL	C$492E
        LD	A,(D.615D)              ; comterm mode
        CPL
        AND	04H                     ; inverse of chinese
        LD	(D.61C5),A              ; english flag
        XOR	A
        LD	(D.61C3),A
        LD	(D.61C4),A
        LD	(CSRX),A
        LD	(CSRY),A                ; cursor at 0,0
        LD	(D.61D3),A
        LD	A,(D.6361)
        OR	A                       ; output to modem ?
        JR	NZ,J$40E8               ; yep, skip
        CALL	C$4343                  ; save cursor position, encoding shift state and formatting attributes
        CALL	C.4555
        CALL	C.50EC
        CALL	C$468E
J$40E8:	JR	J.412F

;	  Subroutine revert to normal graphic screen
;	     Inputs  ________________________
;	     Outputs ________________________

J$40EA:	CALL	C$46CC
        JP	J$4A5C

;	  Subroutine print to screen/printer
;	     Inputs  ________________________
;	     Outputs ________________________

J$40F0:	PUSH	AF
        CALL	C.50EC
        POP	AF
        CALL	C$4103
        JP	C.50EC

;	  Subroutine store for resume and quit
;	     Inputs  ________________________
;	     Outputs ________________________

C.40FB:	LD	(D.61B1),HL             ; store HL
        POP	HL
        LD	(D.61AF),HL             ; store resume address
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$4103:	CP	0FFH
        RET	Z
        CP	20H                     ; control code ?
        JR	C,J$4116                ; yep,
        CP	7FH                     ; DEL ?
        JR	NZ,J$4127               ; nope, restore for resume
        LD	A,(D.615D)              ; comterm mode
        BIT	7,A                     ; DEL operation
        RET	Z                       ; no operation, quit
        LD	A,8                     ; BS
J$4116:	CP	1AH                     ; EOF ?
        JR	NZ,J$411C               ; nope,
        LD	A,18H
J$411C:	CP	18H                     ; SEL ?
        JR	Z,J$4132                ; yep,
        CP	1BH                     ; ESC ?
        JR	Z,J$4137                ; yep,
        JP	C.4197                  ; handler other control codes

;	  Subroutine restore for resume
;	     Inputs  ________________________
;	     Outputs ________________________

J$4127:	LD	HL,(D.61AF)
        PUSH	HL                      ; return to resume address
        LD	HL,(D.61B1)             ; restore HL
        RET

J.412F:	CALL	C.40FB                  ; store for resume and quit
J$4132:	CALL	C.4197                  ; handle other control codes
        JR	J.412F

; ESC

J$4137:	CALL	C.40FB                  ; store for resume and quit
        CP	30H
        JR	C,J$414B
        CP	80H
        JR	NC,J.412F
        CP	"["
        JR	Z,J$4169
        CALL	C$42A1
        JR	J.412F

J$414B:	CP	"*"
        JR	NZ,J$4156

; ESC *

        LD	A,12                    ; CLS
        CALL	C.4197                  ; handle other control codes
        JR	J.412F

J$4156:	LD	(D.61B3),A              ; store first ESC character
J$4159:	CALL	C.40FB                  ; store for resume and quit
        CP	30H
        JR	C,J$4159
        CP	80H
        JR	NC,J.412F
        CALL	C$42D7
        JR	J.412F

; ESC [

J$4169:	LD	HL,D.61B3
        LD	(HL),0
        INC	HL
        LD	(HL),0
        INC	HL
        LD	(HL),0
        DEC	HL
        CALL	C.40FB                  ; store for resume and quit
        CALL	C.42F0
        JR	NC,J.4185
        CP	30H
        JR	C,J.412F
        CP	40H
        JR	NC,J$418D
J.4185:	CALL	C.40FB                  ; store for resume and quit
        CALL	C.42F0
        JR	NC,J.4185
J$418D:	CP	80H
        JR	NC,J.412F
        EX	DE,HL
        CALL	C$431B
        JR	J.412F

;	  Subroutine handle other control codes
;	     Inputs  ________________________
;	     Outputs ________________________

C.4197:	CALL	C$4230
        PUSH	AF
        LD	A,(D.61D8)              ; number of colunms
        DEC	A
        LD	HL,CSRX
        CP	(HL)                    ; cursor column position at end of line ?
        JR	NC,J$41AD               ; nope,
        XOR	A
        LD	(HL),A
        CALL	C.428B                  ; new line
        CALL	C.4555
J$41AD:	POP	AF

;	  Subroutine display character
;	     Inputs  ________________________
;	     Outputs ________________________

C.41AE:	LD	L,A
        LD	A,(D.61C5)
        OR	A                       ; english ?
        JR	NZ,C.41FB               ; yep,
        LD	A,(D.61C4)
        OR	A
        JR	NZ,J$41CC
        LD	A,L
        CP	80H
        JR	C,C.41FB
        CP	0A0H
        JR	C,J$41C8
        CP	0E0H
        JR	C,C.41FB
J$41C8:	LD	(D.61C4),A
        RET

J$41CC:	LD	H,A
        XOR	A
        LD	(D.61C4),A
        PUSH	HL
        LD	A,(D.61D8)              ; number of colunms
        DEC	A
        LD	HL,CSRX
        CP	(HL)
        JR	NZ,J$41E4
        LD	L,20H	; " "
        CALL	C.41FB
        CALL	C$42C0
J$41E4:	POP	HL
        CALL	C.421A
        LD	A,(D.61D4)
        AND	40H
        JR	Z,J$41F2
        LD	HL,I$2121
J$41F2:	CALL	C$4CA4
        LD	HL,CSRX
        INC	(HL)
        JR	J$420C

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.41FB:	LD	A,(D.61D4)
        AND	40H
        JR	Z,J$4204
        LD	L,20H	; " "
J$4204:	LD	H,00H
        CALL	C$4C40
        LD	HL,CSRX
J$420C:	INC	(HL)
        LD	A,(D.61D8)              ; number of colunms
        CP	(HL)
        RET	NZ
        DEC	(HL)
        PUSH	HL
        CALL	C.4555
        POP	HL
        INC	(HL)
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.421A:	LD	A,H
        XOR	0A0H
        ADD	A,A
        LD	H,A
        LD	A,L
        LD	DE,I$DEE1
        ADD	HL,DE
        CP	7FH
        RET	C
        DEC	HL
        CP	9FH
        RET	C
        LD	DE,I$00A2
        ADD	HL,DE
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$4230:	LD	HL,D.61C3
        DEC	(HL)                    ; get and reset graphic header flag
        JR	NZ,J$4239               ; nope,
        SUB	40H                     ; remove graphic offset
        RET

J$4239:	CP	7FH                     ; DEL character ?
        JR	Z,J.4245                ; yep,
        CP	0FFH
        JR	Z,J.4245
        INC	(HL)
        CP	20H                     ; control character ?
        RET	NC                      ; nope, quit
J.4245:	POP	BC
        CP	1                       ; graphic header ?
        JR	NZ,J$424C               ; nope,
        INC	(HL)                    ; set graphic header flag
        RET

J$424C:	CP	7                       ; BELL character ?
        JP	Z,BEEP                  ; yep,
        LD	HL,CSRX
        CP	8                       ; BS character ?
        JR	Z,J$4276                ; yep,
        LD	BC,C.4555
        PUSH	BC
        CP	9                       ; TAB character ?
        JR	Z,J$427B
        CP	10                      ; LF character ?
        JR	Z,C.428B                ; yep, new line
        CP	11
        JR	Z,J$4293
        CP	12                      ; clear screen character ?
        JR	Z,J$428E                ; yep,
        CP	13                      ; cr character ?
        JR	Z,J$4296                ; yep,
        POP	BC
        CP	18H
        JR	Z,J$4299
        RET

J$4276:	LD	A,01H	; 1 
        JP	J.4521

J$427B:	LD	A,(HL)
        OR	07H
        INC	A
        PUSH	HL
        LD	HL,D.61D8              ; number of colunms
        CP	(HL)
        JR	C,J$4288
        LD	A,(HL)
        DEC	A
J$4288:	POP	HL
        LD	(HL),A
        RET

;	  Subroutine new line
;	     Inputs  ________________________
;	     Outputs ________________________

C.428B:	JP	J$42C4

;	  Subroutine clear screen, cursor home
;	     Inputs  ________________________
;	     Outputs ________________________

J$428E:	PUSH	HL
        CALL	C$43B2                  ; clear screen
        POP	HL
J$4293:	LD	(HL),0
        DEC	HL
J$4296:	LD	(HL),0
        RET

J$4299:	XOR	A
        LD	(D.61C3),A
        LD	(D.61C4),A
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$42A1:	LD	BC,5
        CALL	C.456B

        DEFB    "78MDE"
        DEFB    (C$4343-$),(C.4356-$),(C.42B1-$),(J$42C4-$),(C$42C0-$)

;	  Subroutine remove line (ESC M)
;	     Inputs  ________________________
;	     Outputs ________________________

C.42B1: LD      A,(CSRY)
        OR      A
        LD	A,1
        JP	NZ,C.451B
        CALL	C$519D
        JP	C.4555

;	  Subroutine ESC E
;	     Inputs  ________________________
;	     Outputs ________________________

C$42C0:	XOR	A
        LD	(CSRX),A

;	  Subroutine cursor left (ESC D)
;	     Inputs  ________________________
;	     Outputs ________________________

J$42C4:	CALL	C.4787                  ; get number of rows (usable)
        DEC	A
        LD	HL,CSRY
        CP	(HL)
        LD	A,1
        JP	NZ,J.452D
        CALL	C.51DA
        JP	C.4555

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$42D7:	LD	B,A
        LD	A,(D.61B3)              ; first ESC character
        CP	')'
        RET	NZ
        LD	A,(D.615D)              ; comterm mode
        AND	04H                     ; english ?
        RET	Z                       ; yep, quit
        LD	A,B
        SUB	'0'
        JR	Z,J.42EC
        CP	03H
        RET	NZ
J.42EC:	LD	(D.61C5),A              ; english flag
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.42F0:	CP	"0"
        RET	C
        CP	"9"+1
        JR	NC,J$430A
J$42F7:	SUB	"0"
        LD	B,A
        LD	A,(HL)
        CP	19H
        JR	C,J$4303
        LD	A,0FFH
        JR	J$4308

J$4303:	ADD	A,A
        ADD	A,A
        ADD	A,(HL)
        ADD	A,A
        ADD	A,B
J$4308:	LD	(HL),A
        RET

J$430A:	CP	";"
        SCF
        RET	NZ
        PUSH	HL
        LD	DE,D.61C3
        SBC	HL,DE
        POP	HL
        JR	NC,J$4318
        INC	HL
J$4318:	XOR	A
        LD	(HL),A
        RET

;	  Subroutine handle ESC [
;	     Inputs  ________________________
;	     Outputs ________________________

C$431B:	LD	BC,17
        CALL	C.456B

        DEFB    "ABCDHJKML"
        DEFB    "cfhlmnsu"
        DEFB    (C.438F-$),(C.4395-$),(C.439B-$),(C.43A1-$),(C.436E-$),(C.43A7-$),(C.43D0-$),(C.4402-$),(C.440E-$)
        DEFB    (C.441F-$),(C.436E-$),(C.4430-$),(C.4435-$),(C.443A-$),(C.4427-$),(C$4343-$),(C.4356-$)

;	  Subroutine ESC 7, ESC[s
;	     Inputs  ________________________
;	     Outputs ________________________

C$4343:	LD	HL,(CSRY)
        LD	(D.61C9),HL             ; store cursor position
        LD	HL,(D.61D3)
        LD	(D.61CB),HL
        LD	HL,(D.61D5)
        LD	(D.61CD),HL
        RET

;	  Subroutine ESC 8, ESC[u
;	     Inputs  ________________________
;	     Outputs ________________________

C.4356:	LD	HL,(D.61C9)
        LD	(CSRY),HL               ; restore cursor position
        CALL	C.4555
        LD	HL,(D.61CB)
        LD	(D.61D3),HL
        LD	HL,(D.61CD)
        LD	(D.61D5),HL
        JP	C.4B8C

;	  Subroutine ESC [H, ESC[f
;	     Inputs  ________________________
;	     Outputs ________________________

C.436E:	CALL	C.4787                  ; get number of rows (usable)
        LD	E,A
        LD	HL,D.61B4
        CALL	C.4388
        DEC	A
        PUSH	AF
        LD	A,(D.61D8)              ; number of colunms
        LD	E,A
        INC	HL
        CALL	C.4388
        DEC	A
        LD	E,A
        POP	AF
        JP	C.4513                  ; update cursor position

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.4388:	CALL	C$4566
        CP	E
        RET	C
        LD	A,E
        RET

;	  Subroutine ESC [A
;	     Inputs  ________________________
;	     Outputs ________________________

C.438F:	CALL	C.4563
        JP	C.451B

;	  Subroutine ESC [B
;	     Inputs  ________________________
;	     Outputs ________________________

C.4395:	CALL	C.4563
        JP	J.452D

;	  Subroutine ESC [C
;	     Inputs  ________________________
;	     Outputs ________________________

C.439B:	CALL	C.4563
        JP	J$4544

;	  Subroutine ESC [D
;	     Inputs  ________________________
;	     Outputs ________________________

C.43A1:	CALL	C.4563
        JP	J.4521

;	  Subroutine ESC [J
;	     Inputs  ________________________
;	     Outputs ________________________

C.43A7:	LD	A,(D.61B4)
        OR	A
        JR	Z,J$43C3
        DEC	A
        JR	Z,J$43B9
        DEC	A
        RET	NZ

;	  Subroutine clear screen
;	     Inputs  ________________________
;	     Outputs ________________________

C$43B2:	CALL	C.4787                  ; get number of rows (usable)
        LD	E,A                     ; last row = number of rows
        XOR	A                       ; first row = 0
        JR	J.43E0                  ; clear screen (partly)

J$43B9:	CALL	C.43E3
        LD	A,(CSRY)
        LD	E,A                     ; last row = until cursor row
        XOR	A                       ; first row = 0
        JR	J.43E0                  ; clear screen (partly)

J$43C3:	CALL	C.43F1
        CALL	C.4787                  ; get number of rows (usable)
        LD	E,A                     ; last row
        LD	A,(CSRY)
        INC	A                       ; first row = below cursor row
        JR	J.43E0                  ; clear screen (partly)

;	  Subroutine ESC [K
;	     Inputs  ________________________
;	     Outputs ________________________

C.43D0:	LD	A,(D.61B4)
        OR	A
        JR	Z,C.43F1
        DEC	A
        JR	Z,C.43E3
        DEC	A
        RET	NZ
        LD	A,(CSRY)
        LD	E,A
        INC	E
J.43E0:	JP	C.52AD                  ; clear screen (partly)

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.43E3:	LD	E,00H
        LD	A,(CSRX)
        LD	HL,D.61D8               ; number of colunms
        CP	(HL)
        JR	Z,C.43F8
        INC	A
        JR	C.43F8

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.43F1:	LD	A,(CSRX)
        LD	E,A
        LD	A,(D.61D8)              ; number of colunms

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.43F8:	SUB	E
        RET	Z
        RET	C
        LD	D,A
        LD	A,(CSRY)
        JP	J$5407

;	  Subroutine ESC [M
;	     Inputs  ________________________
;	     Outputs ________________________

C.4402:	CALL	C.4563
        LD	B,A
        LD	A,(CSRY)
        CALL	C.5299
        JR	J$4418

;	  Subroutine ESC [L
;	     Inputs  ________________________
;	     Outputs ________________________

C.440E:	CALL	C.4563
        LD	B,A
        LD	A,(CSRY)
        CALL	C.52B8
J$4418:	XOR	A
        LD	(CSRX),A
        JP	C.4555

;	  Subroutine ESC [c
;	     Inputs  ________________________
;	     Outputs ________________________

C.441F:	LD	A,(D.61B4)
        OR	A
        RET	NZ
        JP	J$44C1

;	  Subroutine ESC [n
;	     Inputs  ________________________
;	     Outputs ________________________

C.4427:	LD	A,(D.61B4)
        CP	06H
        RET	NZ
        JP	J$44D7

;	  Subroutine ESC [h
;	     Inputs  ________________________
;	     Outputs ________________________

C.4430:	LD	A,"h"
        JP	J.44E8

;	  Subroutine ESC [l
;	     Inputs  ________________________
;	     Outputs ________________________

C.4435:	LD	A,"l"
        JP	J.44E8

;	  Subroutine ESC [m
;	     Inputs  ________________________
;	     Outputs ________________________

C.443A:	EX	DE,HL
        INC	HL
        LD	DE,D.61B4
        OR	A
        SBC	HL,DE
        LD	B,L
J$4443:	LD	A,(DE)
        PUSH	DE
        PUSH	BC
        CALL	C$445E
        POP	BC
        POP	DE
        INC	DE
        LD	HL,D.61D4
        OR	(HL)
        LD	(HL),A
        DJNZ	J$4443
        LD	HL,D.61D4
        LD	A,(HL)
        RRCA
        RET	NC
        RES	0,(HL)
        JP	C.4B8C

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$445E:	LD	HL,D.61D4
        OR	A
        JR	Z,J$4497
        DEC	A
        JR	Z,J$449C
        SUB	03H
        JR	Z,J$449F
        DEC	A
        JR	Z,J$44A2
        DEC	A
        JR	Z,J.44A5
        DEC	A
        JR	Z,J$44A8
        DEC	A
        JR	Z,J.44A5
        SUB	08H
        JR	Z,J.44A5
        INC	HL
        SUB	0EH
        CP	08H
        JR	C,J.44BD
        SUB	14H
        CP	08H
        JR	C,J.44B3
        INC	HL
        SUB	0F6H
        CP	08H
        JR	C,J.44BD
        SUB	14H
        CP	08H
        JR	C,J.44B3
        XOR	A
        RET

J$4497:	CALL	C.4B52
        XOR	A
        RET

J$449C:	LD	A,03H
        RET

J$449F:	LD	A,11H
        RET

J$44A2:	LD	A,21H
        RET

J.44A5:	LD	A,41H
        RET

J$44A8:	LD	A,81H
        RET

I$44AB:	EX	AF,AF'
        LD	A,(BC)
        INC	C
        DEC	C
        ADD	HL,BC
        DEC	BC
        LD	C,0FH
J.44B3:	LD	DE,I$44AB
        ADD	A,E
        LD	E,A
        LD	A,00H
        ADC	A,D
        LD	D,A
        LD	A,(DE)
J.44BD:	LD	(HL),A
        LD	A,1
        RET

J$44C1:	CALL	C.44CE
        LD	A,(D.615D)              ; comterm mode
        AND	04H                     ; chinese
        RRCA
        RRCA                            ; to b0
        JP	J$589E

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.44CE:	CALL	C.4787                  ; get number of rows (usable)
        LD	L,A
        LD	A,(D.61D8)              ; number of colunms
        LD	H,A
        RET

J$44D7:	LD	HL,(CSRY)
        LD	A,(D.61D8)              ; number of colunms
        CP	H                       ; at end of line ?
        JR	NZ,J$44E3               ; nope,
        LD	H,0
        INC	L                       ; start of new line
J$44E3:	INC	H
        INC	L                       ; 1 based
        JP	J$58D1

J.44E8:	PUSH	AF
        LD	(D.61B3),A              ; store first ESC character
        CP	">"
        JR	NZ,J$44F2
        POP	AF
        RET

J$44F2:	POP	AF
        LD	HL,I$46D5
        LD	E,1
        CP	"h"
        JR	Z,J$4503
        LD	HL,I$4697
        DEC	E
        CP	"l"
        RET	NZ
J$4503:	LD	A,(D.61B4)
        CP	01H
        JR	Z,J$4512
        CP	05H
        RET	NZ
        LD	A,E
        LD	(D.61D3),A
        RET

J$4512:	JP	(HL)

;	  Subroutine update cursor position
;	     Inputs  E = column, A = row
;	     Outputs ________________________

C.4513:	LD	HL,CSRY
        LD	(HL),A
        INC	HL
        LD	(HL),E
        JR	C.4555

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.451B:	LD	E,A
        LD	HL,CSRY
        JR	J$4525

J.4521:	LD	E,A
        LD	HL,CSRX
J$4525:	LD	A,(HL)
        SUB	E
        JR	NC,J$452A
        XOR	A
J$452A:	LD	(HL),A
        JR	C.4555

J.452D:	LD	HL,CSRY
        ADD	A,(HL)
        JR	NC,J$4534
        SBC	A,A
J$4534:	LD	D,A
        CALL	C.4787                  ; get number of rows (usable)
        LD	E,A
        LD	A,D
        CP	E
        JR	C,J$453F
        DEC	E
        LD	A,E
J$453F:	LD	(CSRY),A
        JR	C.4555

J$4544:	LD	HL,CSRX
        ADD	A,(HL)
        JR	NC,J$454B
        SBC	A,A
J$454B:	LD	HL,D.61D8              ; number of colunms
        CP	(HL)
        JR	C,J$4552
        LD	A,(HL)
J$4552:	LD	(CSRX),A

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.4555:	LD	HL,(CSRY)
        LD	A,(D.61D8)              ; number of colunms
        DEC	A
        CP	H
        JR	NC,J$4560
        LD	H,A
J$4560:	JP	J$54AB

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.4563:	LD	HL,D.61B4

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$4566:	LD	A,(HL)
        OR	A
        RET	NZ
        INC	A
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.456B:	POP	HL
        PUSH	BC
        CPIR
        POP	BC
        RET	NZ
        DEC	HL
        ADD	HL,BC
        LD	C,(HL)
        LD	B,0
        ADD	HL,BC
J$4577:	JP	(HL)

I$4578:	JR	J$4577

?.457A:	SUB	E
        CALL	M,C$CD97
        NOP
J$457F:	XOR	A
        LD	(D.61D1),A
        LD	(D.61D0),A
        CALL	C$45CF
        LD	A,02H	; 2 
        CALL	C.469F
        LD	HL,I$4578
        XOR	A
        CALL	C.4596
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.4596:	CALL	C.4793
        PUSH	AF
        PUSH	HL
        LD	A,(D.61D1)
        LD	E,A
        LD	A,(D.61D7)              ; number of rows
        DEC	A
        LD	HL,D.61D9
        ADD	A,(HL)
        CALL	C.4513                  ; update cursor position
        LD	A,(D.61D2)
        LD	B,A
        CALL	C.4657
        XOR	A
        LD	(D.61D3),A
        CALL	C.50EC
        POP	HL
        CALL	C.45E3
        LD	A,(D.61D0)
        LD	E,A
        POP	AF
        ADD	A,04H	; 4 
        CALL	C.43F8
        CALL	C.50EC
        LD	A,(CSRX)
        LD	(D.61D1),A              ; store cursor column position

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$45CF:	LD	A,(FORCLR)
        AND	0FH
        RLCA
        RLCA
        RLCA
        RLCA
        LD	H,A
        LD	A,(BAKCLR)
        AND	0FH
        OR	H
        LD	(D.61D2),A
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.45E3:	CALL	C$45F5
        PUSH	HL
        LD	A,(CSRX)
        LD	HL,D.61D0
        CP	(HL)
        JR	C,J$45F1
        LD	(HL),A
J$45F1:	POP	HL
        INC	HL
        JR	C.45E3

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$45F5:	LD	A,(HL)
        POP	BC
        OR	A
        RET	Z
        PUSH	BC
        CP	20H
        JR	NC,J$4670               ; display character
        CP	10H	; 16 
        JR	NC,J$460F
        CP	05H	; 5 
        JR	Z,J.463E
        CP	08H	; 8 
        JR	Z,J$4633
        CP	0CH	; 12 
        JR	Z,J$4639
        RET

J$460F:	INC	HL
        LD	B,(HL)
        CP	12H	; 18 
        JR	Z,J$4624
        CP	17H
        JR	Z,J$4622
        CP	18H
        JR	Z,C.4645
        CP	1AH
        JR	Z,C.4657
        RET

J$4622:	LD	E,B
        RET

J$4624:	PUSH	HL
        LD	A,(CSRX)
        LD	E,A
        LD	D,B
        LD	A,(D.61D8)              ; number of colunms
        DEC	A
        CALL	C$53F8
        POP	HL
        RET

J$4633:	LD	A,(CSRX)
        LD	B,A
        JR	J.463E

J$4639:	LD	B,01H	; 1 
        CALL	C.4645
J.463E:	LD	A,(CSRX)
        LD	(D.61D0),A
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.4645:	PUSH	HL
        LD	A,B
        ADD	A,3
        LD	E,A
        LD	A,(D.61D7)              ; number of rows
        DEC	A
        LD	HL,D.61D9
        ADD	A,(HL)
        CALL	C.4513                  ; update cursor position
        POP	HL
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.4657:	PUSH	HL
        LD	A,B
        LD	(D.61D2),A
        AND	0FH
        LD	(BAKCLR),A
        LD	A,B
        RRCA
        RRCA
        RRCA
        RRCA
        AND	0FH
        LD	(FORCLR),A
        CALL	C.4B52
        POP	HL
        RET

J$4670:	PUSH	HL
        CALL	C.41AE                  ; display character
        POP	HL
        RET

J$4676:	LD	A,2
        JR	J$46D7

J$467A:	PUSH	AF
        PUSH	HL
        PUSH	DE
        PUSH	BC
        LD	A,(FNKSWI)
        LD	HL,NEWKEY+6
        XOR	(HL)
        RRCA
        CALL	C,C.46F0                ; update function key display
        POP	BC
        POP	DE
        POP	HL
        POP	AF
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$468E:	XOR	A
        LD	(D.61C8),A
        LD	A,(CNSDFG)
        OR	A                       ; functionkey display enabled ?
        RET	Z                       ; nope, quit
I$4697:	LD	A,1
        CALL	C.469F
        RET	C
        JR	C.46F0                  ; update functionkey display

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.469F:	PUSH	AF
        LD	HL,D.61C8
        OR	(HL)
        LD	(HL),A
        POP	AF
        CALL	C.477E
        RET	C
        LD	A,(D.61D7)              ; number of rows
        DEC	A
        LD	HL,D.61D9
        ADD	A,(HL)
        LD	HL,CSRY
        CP	(HL)
        JR	NZ,J$46C2
        LD	A,01H	; 1 
        CALL	C.51DA
        LD	A,01H	; 1 
        CALL	C.451B
J$46C2:	LD	A,0FFH
        LD	(CNSDFG),A              ; functionkey display enabled
        CALL	C.4772
        XOR	A
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$46CC:	LD	A,(D.61C8)
        RRCA
        SBC	A,A
        LD	(CNSDFG),A              ; update functionkey display
        RET

I$46D5:	LD	A,1
J$46D7:	PUSH	AF
        LD	HL,D.61C8
        CPL
        AND	(HL)
        LD	(HL),A
        POP	AF
        CALL	C.477E
        RET	C
        AND	(HL)
        JR	NZ,J$46ED
        LD	HL,CNSDFG
        XOR	A
        CP	(HL)                    ; functionkey display enabled ?
        LD	(HL),A                  ; functionkey display disabled
        RET	Z                       ; nope, quit
J$46ED:	CALL	C.4772

;	  Subroutine update function key display
;	     Inputs  ________________________
;	     Outputs ________________________

C.46F0:	LD	A,01H	; 1 
        CALL	C.477E
        RET	NZ
        CALL	C.4772
        CALL	C.4793
        CALL	C.4B52
        LD	A,(D.61D7)              ; number of rows
        DEC	A
        LD	HL,D.61D9
        ADD	A,(HL)
        LD	L,A
        LD	H,0
        LD	(CSRY),HL
        CALL	C.4555
        LD	A,(NEWKEY+6)
        RRCA                            ; shift pressed ?
        LD	HL,FNKSTR+0*16
        LD	A,1
        JR	C,J$471F                ; nope,
        LD	HL,FNKSTR+5*16
        XOR	A
J$471F:	LD	(FNKSWI),A
        LD	C,5                     ; 5 function key definitions
        LD	A,(D.61D8)              ; number of colunms
        CALL	C$4764                  ; calculate function key definition display size
        RET	C
J$472B:	PUSH	BC
        LD	C,0
J$472E:	LD	A,(HL)
        INC	HL
        INC	C
        CP	21H
        JR	C,J.4746
        CP	7FH
        JR	Z,J.4746
        CP	0FFH
        JR	Z,J.4746
        PUSH	HL
        PUSH	BC
        CALL	C.41AE                  ; display character
        POP	BC
        POP	HL
        JR	J$4749

J.4746:	CALL	C.4758
J$4749:	DJNZ	J$472E
        LD	A,10H
        SUB	C
        LD	C,A
        ADD	HL,BC
        CALL	C.4758
        POP	BC
        DEC	C
        JR	NZ,J$472B               ; next function key definition
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.4758:	PUSH	HL
        PUSH	BC
        LD	HL,CSRX
        INC	(HL)
        CALL	C.4555
        POP	BC
        POP	HL
        RET

;	  Subroutine calculate function key definition display size
;	     Inputs  ________________________
;	     Outputs ________________________

C$4764:	SUB	4
        RET	C
        LD	B,-1
J$4769:	INC	B
        SUB	5
        JR	NC,J$4769
        LD	A,B
        SUB	1
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.4772:	LD	A,(D.61D7)              ; number of rows
        LD	HL,D.61D9
        ADD	A,(HL)
        LD	E,A
        DEC	A
        JP	C.52AD                  ; clear screen (partly)

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.477E:	LD	HL,D.61C8
        LD	B,A
        DEC	A
        AND	(HL)
        OR	B
        CP	(HL)
        RET

;	  Subroutine get number of rows (usable)
;	     Inputs  ________________________
;	     Outputs ________________________

C.4787:	LD	A,(D.61D7)              ; number of rows
        LD	HL,D.61D9
        ADD	A,(HL)
        LD	HL,CNSDFG
        ADD	A,(HL)                  ; adjust if functionkey display enabled
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.4793:	EXX
        EX	AF,AF'
        POP	BC
        LD	HL,(D.61C4)
        PUSH	HL
        LD	HL,0
        LD	(D.61C4),HL
        LD	HL,(CSRY)
        PUSH	HL
        LD	HL,(D.61D5)
        PUSH	HL
        LD	HL,(D.61D3)
        PUSH	HL
        LD	HL,(FORCLR)
        PUSH	HL
        CALL	C$47D1
        POP	HL
        LD	(FORCLR),HL
        CALL	C.4B52
        POP	HL
        LD	(D.61D3),HL
        POP	HL
        LD	(D.61D5),HL
        CALL	C.4B8C
        POP	HL
        LD	(CSRY),HL
        CALL	C.4555
        POP	HL
        LD	(D.61C4),HL
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$47D1:	PUSH	BC
        EXX
        EX	AF,AF'
        RET

I$47D5:	LD	(BC),A
        LD	HL,(D$330B)
        DEC	D
        DEC	A
        RRA
        LD	B,A
        INC	HL
        LD	C,E

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.47DF:	LD	L,A
        LD	H,0
        ADD	HL,HL
        LD	A,(SCRMOD)
        LD	DE,I$47D5
        CP	6
        JR	C,J$47EE
        INC	E
J$47EE:	ADD	HL,DE
        LD	D,(HL)
        LD	E,0
        RET

J$47F3:	LD	A,(D.61D9)
        OR	A
        RET	Z
        CALL	C.4793
        LD	A,2
        CALL	C.47DF
        CALL	C.4910
        LD	HL,I$48EA
        CALL	C.4905                  ; display string
        LD	A,4
        CALL	C.47DF
        CALL	C.4910
        LD	HL,I$48F4
        JP	C.4905                  ; display string

J$4817:	LD	A,(D.61D9)
        OR	A
        RET	Z
        CALL	C.4793
        LD	A,3
        CALL	C.47DF
        CALL	C.4910
        LD	HL,(D.61A6)
        LD	A,H
        RRCA
        AND	7FH
        CALL	C$484A
        LD	A,"."
        CALL	C.41AE                  ; display character
        LD	HL,(D.61A6)
        SRL	H
        RR	L
        LD	A,L
        CALL	C$487D
        AND	0F0H
        RRCA
        RRCA
        RRCA
        RRCA
        JP	C.48DA                  ; display digit

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$484A:	CALL	C$4868
        PUSH	AF
        RRCA
        RRCA
        RRCA
        RRCA
        AND	0FH
        CALL	Z,C$4860                ; display '.'
        CALL	NZ,C.48DA               ; display digit
        POP	AF
        AND	0FH
        JP	C.48DA                  ; display digit

;	  Subroutine display ' '
;	     Inputs  ________________________
;	     Outputs ________________________

C$4860:	PUSH	AF
        LD	A," "
        CALL	C.41AE                  ; display character
        POP	AF
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$4868:	LD	B,05H	; 5 
        LD	D,01H	; 1 
        LD	C,A
        XOR	A
J$486E:	SRL	C
        JR	NC,J$4874
        ADD	A,D
        DAA
J$4874:	PUSH	AF
        LD	A,D
        ADD	A,A
        DAA
        LD	D,A
        POP	AF
        DJNZ	J$486E
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$487D:	LD	B,05H	; 5 
        LD	HL,I$488E
        LD	C,A
        XOR	A
J$4884:	SLA	C
        JR	NC,J$488A
        ADD	A,(HL)
        DAA
J$488A:	INC	HL
        DJNZ	J$4884
        RET

I$488E:	LD	D,B
        DEC	H
        LD	(DE),A
        LD	B,03H	; 3 
J$4893:	LD	A,(D.61D9)
        OR	A
        RET	Z
        CALL	C.4793
        XOR	A
        CALL	C.47DF
        CALL	C.4910
        LD	HL,I$48E1
        JP	C.4905                  ; display string

J$48A8:	LD	A,(D.61D9)
        OR	A
        RET	Z
        CALL	C.4793
        LD	A,1
        CALL	C.47DF
        CALL	C.4910
        LD	A,(D$61A3)
        CALL	C.48D1
        LD	A,":"
        CALL	C.41AE                  ; display character
        LD	A,(D$61A4)
        CALL	C.48D1
        LD	A,":"
        CALL	C.41AE                  ; display character
        LD	A,(D$61A5)

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.48D1:	PUSH	AF
        RRCA
        RRCA
        RRCA
        RRCA
        CALL	C.48DA                  ; display digit
        POP	AF

;	  Subroutine display digit
;	     Inputs  ________________________
;	     Outputs ________________________

C.48DA:	AND	0FH
        ADD	A,"0"
        JP	C.41AE                  ; display character

I$48E1:	SUB	B
        JP	C,J$B191
        ADC	A,(HL)
        SBC	A,(HL)
        ADC	A,D
        CALL	NC,C$CA00
I$48EA	EQU	$-1
        SBC	A,0AFH
        CALL	Z,C$8EA7
        LD	H,E
        SUB	A
        JP	Z,J$4B00
I$48F4	EQU	$-1
        JP	Z,J$B2DE
        CALL	NZ,C$3A00
J$48FA	EQU	$-1
        EXX
        LD	H,C
        OR	A
        RET	Z
        CALL	C.4793
        CALL	C.4910

;	  Subroutine display string
;	     Inputs  ________________________
;	     Outputs ________________________

C.4905:	LD	A,(HL)
        OR	A
        RET	Z
        INC	HL
        PUSH	HL
        CALL	C.41AE                  ; display character
        POP	HL
        JR	C.4905

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.4910:	PUSH	HL
        PUSH	DE
        LD	A,(D$7EEC)
        LD	(FORCLR),A
        CALL	C.4B52
        POP	DE
        LD	A,(D.61D7)              ; number of rows
        LD	HL,D.61D9
        ADD	A,(HL)
        ADD	A,E
        LD	L,A
        LD	H,D
        LD	(CSRY),HL
        CALL	C.4555
        POP	HL
        RET

;	  Subroutine __________________________
;	     Inputs  A = comterm mode
;	     Outputs ________________________

C$492E:	LD	B,A
        LD	A,(D$7EFB)
        LD	(D.61E8),A
        LD	A,(D.6361)
        OR	A                       ; output to modem ?
        JR	NZ,J.4953               ; yep,
        LD	A,(MODE)
        AND	06H                     ; VRAM size
        JR	Z,J$494F                ; 16 KB,
        CP	04H
        JR	NC,J.4953               ; 128 KB,
        LD	A,B
        AND	18H
        CP	18H
        JR	NZ,J.4953
        JR	J$4951

J$494F:	RES	4,B
J$4951:	RES	3,B
J.4953:	LD	A,B
        BIT	0,C
        JR	Z,J$4965
        RRCA
        RRCA
        RRCA
        RRC	B
        RLA
        AND	07H
        LD	HL,I$4AA2
        JR	J$496A

J$4965:	AND	1FH
        LD	HL,I$4A82
J$496A:	LD	D,0
        LD	E,A
        ADD	HL,DE
        LD	B,(HL)
        LD	A,B
        AND	07H                     ; b2-b0
        LD	(D.61DC),A
        LD	A,B
        AND	18H                     ; b4-b3
        JR	Z,J$497F                ; zero, use screen mode 2
        RRCA
        RRCA
        RRCA                            ; to b1-b0
        ADD	A,2                     ; screen mode 5,6 or 7
J$497F:	ADD	A,2
        LD	(SCRMOD),A
        LD	A,B
        AND	18H
        RRCA
        RRCA                            ; to b2-b1
        LD	HL,I$4AAA
        LD	E,A
        LD	D,0
        ADD	HL,DE
        LD	DE,D.61DB
        LDI
        CALL	C.4A72
        LD	A,0
        JR	C,J$499E
        LD	A,0FFH
J$499E:	LD	(D.61D9),A
        LD	A,(D.61DC)
        ADD	A,A
        ADD	A,A
        ADD	A,(HL)
        ADD	A,A
        LD	HL,I$4AB2               ; screen size table
        LD	E,A
        LD	D,0
        ADD	HL,DE
        CALL	C.4A72
        JR	C,J$49B8
        LD	DE,16
        ADD	HL,DE
J$49B8:	LD	DE,D.61D7
        LDI                             ; number of rows
        LD	A,(HL)
        LD	(DE),A                  ; number of columns
        LD	L,A
        CALL	C.54D0
        EX	DE,HL
        CALL	C.53E8
        OR	A
        SBC	HL,DE
        SRL	H
        RR	L
        CALL	C.56A5                  ; screen mode 2 ?
        JR	NZ,J$49D7               ; nope,
        LD	A,L
        AND	0F8H
        LD	L,A
J$49D7:	LD	A,L
        LD	(D.61DD),A
        LD	A,(D.61DC)
        ADD	A,A
        LD	HL,I$4B02
        LD	E,A
        LD	D,0
        ADD	HL,DE
        CALL	C.4A72
        JR	C,J$49EF
        INC	HL
        INC	HL
        INC	HL
        INC	HL
J$49EF:	LD	DE,D.61E3
        LDI
        LDI
        CALL	C$569F
        JR	NZ,J$4A00
        LD	A,10H	; 16 
        LD	(D.61E4),A
J$4A00:	LD	A,(VDP.DR)
        LD	(D.61DA),A              ; store VDP data read port
        LD	A,(D.6361)
        OR	A                       ; output to modem ?
        RET	NZ                      ; yep, quit
        LD	A,(SCRMOD)
        CALL	CHGMOD                  ; change screen mode
        CALL	C$4B16
        CALL	C.4B52
        CALL	C$553C
        LD	A,(D.61D7)
        LD	E,A                     ; number of rows
        CALL	C.56A5                  ; screen mode 2 ?
        JR	Z,J$4A24                ; yep,
        INC	E
J$4A24:	XOR	A                       ; first row = 0
        CALL	C.52AD                  ; clear screen (partly)
        CALL	C.56A5                  ; screen mode 2 ?
        RET	Z                       ; yep, quit
        LD	BC,(RG8SAV-1)
        SET	1,B
        LD	A,(D.61DB)
        DEC	A
        JR	NZ,J$4A3A
        SET	5,B
J$4A3A:	LD	C,8
        CALL	C.5678                  ; write VDP register
        EI
        CALL	C.55FC
        JR	Z,J$4A4C
        LD	A,(RG9SAV)
        AND	0F3H
        JR	J$4A58

J$4A4C:	LD	B,3FH	; "?"
        LD	C,2
        CALL	C.5678                  ; write VDP register
        LD	A,(RG9SAV)
        OR	0CH	; 12 
J$4A58:	LD	C,9
        JR	J$4A6E

J$4A5C:	CALL	C.56A5                  ; screen mode 2 ?
        RET	Z                       ; yep, quit
        LD	B,1FH
        LD	C,2
        CALL	C.5678                  ; write VDP register
        LD	A,(RG8SAV)
        AND	0FDH
        LD	C,8
J$4A6E:	LD	B,A
        JP	C.5678                  ; write VDP register

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.4A72:	LD	A,(D.61DC)
        AND	06H
        CP	06H
        RET	C
        LD	A,(D.61E8)
        OR	A
        SCF
        RET	Z
        OR	A
        RET

I$4A82:	DEFB	8*0+0                   ; screen mode 2
        DEFB    8*0+0                   ; screen mode 2
        DEFB    8*0+1                   ; screen mode 2
        DEFB    8*0+1                   ; screen mode 2
        DEFB    8*0+2                   ; screen mode 2
        DEFB    8*0+2                   ; screen mode 2
        DEFB    8*0+2                   ; screen mode 2
        DEFB    8*0+2                   ; screen mode 2

        DEFB    8*1+0                   ; screen mode 5
        DEFB    8*1+0                   ; screen mode 5
        DEFB    8*1+1                   ; screen mode 5
        DEFB    8*1+1                   ; screen mode 5
        DEFB    8*1+2                   ; screen mode 5
        DEFB    8*1+3                   ; screen mode 5
        DEFB    8*2+4                   ; screen mode 6
        DEFB    8*2+5                   ; screen mode 6

        DEFB    8*2+0                   ; screen mode 6
        DEFB    8*2+0                   ; screen mode 6
        DEFB    8*2+1                   ; screen mode 6
        DEFB    8*2+1                   ; screen mode 6
        DEFB    8*2+2                   ; screen mode 6
        DEFB    8*2+3                   ; screen mode 6
        DEFB    8*2+4                   ; screen mode 6
        DEFB    8*2+5                   ; screen mode 6

        DEFB    8*3+0                   ; screen mode 7
        DEFB    8*3+0                   ; screen mode 7
        DEFB    8*3+1                   ; screen mode 7
        DEFB    8*3+1                   ; screen mode 7
        DEFB    8*3+2                   ; screen mode 7
        DEFB    8*3+3                   ; screen mode 7
        DEFB    8*2+4                   ; screen mode 6
        DEFB    8*2+5                   ; screen mode 6

I$4AA2: DEFB    8*0+6                   ; screen mode 2
        DEFB    8*0+6                   ; screen mode 2
        DEFB    8*1+6                   ; screen mode 5
        DEFB    8*1+7                   ; screen mode 5
        DEFB    8*2+6                   ; screen mode 6
        DEFB    8*2+7                   ; screen mode 6
        DEFB    8*3+6                   ; screen mode 7
        DEFB    8*3+7                   ; screen mode 7

I$4AAA: DEFB    2,0
        DEFB    0,1
        DEFB    1,2
        DEFB    0,3

I$4AB2:	DEFB    24,40
        DEFB    26,40
        DEFB    26,80
        DEFB    26,80
        DEFB    24,32
        DEFB    26,32
        DEFB    26,64
        DEFB    26,64
        DEFB    12,32
        DEFB    13,32
        DEFB    13,64
        DEFB    13,64
        DEFB    24,32
        DEFB    26,32
        DEFB    26,64
        DEFB    26,64
        DEFB    12,40
        DEFB    13,40
        DEFB    13,80
        DEFB    13,80
        DEFB    24,40
        DEFB    26,40
        DEFB    26,80
        DEFB    26,80
        DEFB    12,40
        DEFB    15,40
        DEFB    15,80
        DEFB    15,80
        DEFB    12,40
        DEFB    26,40
        DEFB    26,80
        DEFB    26,80
        DEFB    12,40
        DEFB    16,40
        DEFB    16,80
        DEFB    16,80
        DEFB    12,40
        DEFB    30,40
        DEFB    30,80
        DEFB    30,80

I$4B02: DEFB    06H,08H
        DEFB    08H,08H
        DEFB    08H,10H
        DEFB    08H,08H
        DEFB    06H,10H
        DEFB    06H,08H
        DEFB    06H,0EH
        DEFB    06H,08H
        DEFB    06H,0DH
        DEFB    06H,07H

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$4B16:	LD	HL,I$4B42
        LD	B,04H	; 4 
J$4B1B:	LD	A,(D.61DB)
        DEC	A
        RET	NZ
        LD	A,(D.61DC)
        CP	4
        JR	C,J.4B2E
        CP	6
        JR	NC,J.4B2E
        LD	HL,J.4B4A
J.4B2E:	SLA	B
        PUSH	BC
        LD	BC,0*256+16
        CALL	C.5678                  ; write VDP register
        EI
        POP	BC
        LD	A,(D.61DA)
        ADD	A,2                     ; VDP palette register
        LD	C,A
        OTIR
        RET

I$4B42:	DEFB	0,0
        LD	D,L
        DEC	B
        DEFB	0,0
        LD	(HL),A
        RLCA
J.4B4A:	LD	(HL),A
        RLCA
        LD	B,H
        INC	B
        LD	(D$0002),HL
        NOP

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.4B52:	XOR	A
        LD	(D.61D4),A
        LD	HL,(FORCLR)
        LD	A,L
        CALL	C.4B6D
        LD	L,A
        LD	A,H
        CALL	C.4B6D
        LD	H,A
        LD	(D.61D5),HL
        CALL	C.4BA3
        LD	(D.61E2),A
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.4B6D:	AND	0FH	; 15 
        PUSH	HL
        LD	HL,I$4B7C
        ADD	A,L
        LD	L,A
        LD	A,00H
        ADC	A,H
        LD	H,A
        LD	A,(HL)
        POP	HL
        RET

I$4B7C:	EX	AF,AF'
        NOP
        LD	(BC),A
        LD	A,(BC)
        INC	B
        INC	C
        DEC	C
        LD	B,01H	; 1 
        ADD	HL,BC
        INC	BC
        DEC	BC
        LD	C,05H	; 5 
        RRCA
        RLCA

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.4B8C:	LD	A,(D.61D4)
        LD	HL,(D.61D5)
        BIT	1,A
        JR	Z,J$4B9C
        LD	D,A
        LD	A,L
        XOR	08H
        LD	L,A
        LD	A,D
J$4B9C:	BIT	7,A
        JR	Z,C.4BA3
        LD	A,L
        LD	L,H
        LD	H,A

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.4BA3:	LD	A,(D.61DB)
        LD	BC,I$4C20
        DEC	A
        JR	NZ,J.4BBD
        LD	BC,I$4C10
        LD	A,(D.61DC)
        CP	4
        JR	C,J.4BBD
        CP	6
        JR	NC,J.4BBD
        LD	BC,I$4C30
J.4BBD:	LD	E,H
        LD	H,00H
        LD	D,H
        ADD	HL,BC
        LD	L,(HL)
        EX	DE,HL
        ADD	HL,BC
        LD	D,(HL)
        EX	DE,HL
        LD	A,(D.61DC)
        CP	4
        JR	C,J.4BE6
        CP	6
        JR	NC,J.4BE6
        LD	A,L
        CP	H
        LD	HL,D.61D4
        JR	NZ,J$4BDB
        SET	6,(HL)
J$4BDB:	JR	NC,J$4BE1
        SET	7,(HL)
        JR	J$4BE3

J$4BE1:	RES	7,(HL)
J$4BE3:	LD	HL,1
J.4BE6:	LD	A,H
        XOR	L
        LD	(D.61E1),A
        LD	A,(D.61D4)
        LD	(D.61DF),HL
        LD	A,(SCRMOD)
        CP	2
        JR	NZ,J$4BFF
        LD	A,L
        ADD	A,A
        ADD	A,A
        ADD	A,A
        ADD	A,A
        OR	H
        RET

J$4BFF:	CP	06H	; 6 
        LD	A,H
        JR	NZ,J$4C08
        ADD	A,A
        ADD	A,A
        OR	H
        LD	H,A
J$4C08:	ADD	A,A
        ADD	A,A
        ADD	A,A
        ADD	A,A
        OR	H
        LD	H,A
        LD	A,H
        RET

I$4C10:	DEFB	0,0,0
        LD	BC,I.0100
        LD	BC,I.0201
        LD	(BC),A
        LD	(BC),A
        INC	BC
        LD	(BC),A
        INC	BC
        INC	BC
        INC	BC
I$4C20:	LD	BC,I$0208
        LD	A,(BC)
        INC	B
        DEC	C
        RLCA
        RRCA
        NOP
        ADD	HL,BC
        INC	BC
        DEC	BC
        DEC	B
        LD	B,0CH	; 12 
        LD	C,00H
I$4C30	EQU	$-1
        INC	B
        EX	AF,AF'
        INC	C
        LD	(BC),A
        LD	B,0AH	; 10 
        LD	C,01H	; 1 
        DEC	B
        ADD	HL,BC
        DEC	C
        INC	BC
        RLCA
        DEC	BC
        RRCA

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$4C40:	LD	A,(D.61DC)
        CP	2
        JR	NC,J$4C5E
        CALL	C.50AD                  ; copy system character pattern
        CALL	C$4F55
        EI
        LD	HL,(GRPACX)
        LD	BC,(D.61E3)
        LD	B,0
        ADD	HL,BC
        LD	(GRPACX),HL
        JP	J.55A6

J$4C5E:	LD	A,L
        CP	20H
        JR	C,J.4C6F
        CP	80H
        JR	C,J.4C84
        CP	0A0H
        JR	C,J.4C6F
        CP	0E0H
        JR	C,J.4C84
J.4C6F:	CALL	C.50AD                  ; copy system character pattern
        LD	HL,PATWRK
        LD	DE,D.6320
        LD	B,8
J$4C7A:	LD	A,(HL)
        INC	HL
        LD	(DE),A
        INC	DE
        LD	(DE),A
        INC	DE
        DJNZ	J$4C7A
        JR	J.4C9E

J.4C84:	LD	A,(D.61DC)
        CP	6
        JR	C,J$4C90
        CALL	C.4D25                  ; get Matsushita JIS pattern
        JR	J.4C9E

J$4C90:	LD	BC,0FFE0H
        BIT	7,L
        JR	Z,J$4C9A
        LD	BC,02C0H
J$4C9A:	ADD	HL,BC
        CALL	C.4CEC                  ; get kanji pattern
J.4C9E:	CALL	C$4DE7
        JP	J.55A6

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$4CA4:	LD	A,(D.61DC)
        CP	6
        JR	C,J$4CC6
        LD	A,H
        SUB	21H
        RRA
        ADD	A,0EH
        BIT	0,H
        LD	H,A
        LD	A,L
        JR	NZ,J$4CB9
        ADD	A,5EH
J$4CB9:	SUB	21H
        CP	3FH
        CCF
        ADC	A,00H
        LD	L,A
        CALL	C.4D25                  ; get Matsushita JIS pattern
        JR	J$4CE6

J$4CC6:	LD	DE,I$DFE0
        ADD	HL,DE
        PUSH	HL
        LD	L,H
        LD	H,0
        LD	E,L
        LD	D,H
        ADD	HL,HL
        ADD	HL,DE
        ADD	HL,HL
        ADD	HL,HL
        ADD	HL,HL
        ADD	HL,HL
        ADD	HL,HL
        EX	DE,HL
        POP	HL
        LD	H,0
        ADD	HL,DE
        LD	A,H
        CP	04H
        JR	C,J$4CE3
        DEC	H
        DEC	H
J$4CE3:	CALL	C.4CEC                  ; get kanji pattern
J$4CE6:	CALL	C$4DF5
        JP	J$559C

;	  Subroutine get kanji pattern
;	     Inputs  ________________________
;	     Outputs ________________________

C.4CEC:	LD	A,L
        ADD	HL,HL
        ADD	HL,HL
        LD	L,A
        LD	C,0D9H                  ; kanji level 1
        BIT	6,H
        JR	Z,J$4CF8
        LD	C,0DBH                  ; kanji level 2
J$4CF8:	OUT	(C),H
        DEC	C
        OUT	(C),L
        INC	C
        LD	HL,D.6320
        LD	B,8
        INIR
        PUSH	HL
        LD	HL,D.6330
        LD	B,8
        INIR
        EX	(SP),HL
        LD	B,8
        INIR
        POP	HL
        LD	B,8
        INIR
        LD	A,(D.61D4)
        BIT	4,A
        RET	Z
        LD	A,0FFH
        LD	(D.632F),A
        DEC	HL
        LD	(HL),A
        RET

;	  Subroutine get Matsushita JIS pattern
;	     Inputs  H = row, L = col
;	     Outputs ________________________

C.4D25:	IN	A,(40H)
        PUSH	AF
        LD	A,0F7H
        OUT	(40H),A			; select Matsushita KANJI 12x12 switchable I/O
        PUSH	DE
        PUSH	HL
        LD	DE,I$255E
        OR	A
        SBC	HL,DE
        POP	HL
        POP	DE
        JR	NC,J$4D4A
        IN	A,(40H)
        CP	08H			; JIS1 12x12 selected ?
        JR	Z,J.4D42		; yep,
        LD	A,1
        OUT	(42H),A			; select 12x12 JIS1
J.4D42:	CALL	C$4D56
        POP	AF
        CPL
        OUT	(40H),A
        RET

J$4D4A:	IN	A,(41H)
        CP	08H			; JIS2 12x12 selected ?
        JR	Z,J.4D42		; yep
        LD	A,2
        OUT	(42H),A			; select 12x12 JIS2
        JR	J.4D42

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$4D56:	LD	A,H
        OUT	(47H),A			; select row
        LD	A,L
        OUT	(48H),A			; select col
        LD	IX,D.6320
        XOR	A
        LD	(D$632D),A
        LD	(D$633D),A
        CALL	C.4A72
        JR	C,J.4D7A
        CALL	C.56A5                  ; screen mode 2 ?
        JR	Z,J.4D7A                ; yep,
        XOR	A
        LD	(D$632C),A
        LD	(D$633C),A
        JR	J.4DA2

J.4D7A:	XOR	A
        LD	(D.6320),A
        LD	(D.6330),A
        INC	IX
        CALL	C.55FC
        JR	Z,J$4D8D
        CALL	C.56A5                  ; screen mode 2 ?
        JR	NZ,J.4DA2               ; nope,
J$4D8D:	XOR	A
        LD	(D$6321),A
        LD	(D$6331),A
        LD	(D$632E),A
        LD	(D$633E),A
        LD	(D.632F),A
        LD	(D$633F),A
        INC	IX
J.4DA2:	LD	B,6
J$4DA4:	IN	A,(49H)
        LD	(IX+0),A
        RRCA
        RRCA
        AND	0C0H
        LD	C,A
        IN	A,(49H)
        LD	E,A
        RRCA
        RRCA
        AND	3FH
        OR	C
        LD	(IX+16),A
        LD	A,E
        ADD	A,A
        ADD	A,A
        ADD	A,A
        ADD	A,A
        LD	C,A
        IN	A,(49H)
        LD	E,A
        RRCA
        RRCA
        RRCA
        RRCA
        AND	0FH	; 15 
        OR	C
        LD	(IX+1),A
        LD	A,E
        ADD	A,A
        ADD	A,A
        LD	(IX+17),A
        INC	IX
        INC	IX
        DJNZ	J$4DA4
        LD	A,(D.61D4)
        BIT	4,A
        RET	Z
        LD	A,0FFH
        LD	(IX-1),A
        LD	(IX+15),A
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$4DE7:	LD	A,(D.61DC)
        CP	4
        JR	C,J.4E27
        CP	6
        JR	NC,J.4E27
        JP	J$4E72

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$4DF5:	LD	A,(D.61DC)
        CP	4
        JR	C,J$4E01
        CP	6
        JP	C,J$4E75
J$4E01:	CALL	C.56A5                  ; screen mode 2 ?
        JP	Z,J$4E19                ; yep,
        LD	HL,D.6320
        LD	(D.61E6),HL
        CALL	C.4E2D
        LD	HL,D.6330
        LD	(D.61E6),HL
        JP	C.4E2D

J$4E19:	CALL	C.4E2D
        LD	HL,D.6330
        LD	DE,D.6320
        LD	BC,16
        LDIR
J.4E27:	LD	HL,D.6320
        LD	(D.61E6),HL

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.4E2D:	CALL	C.56A5                  ; screen mode 2 ?
        JP	Z,J$4E44                ; yep,
        CALL	C$4F63
        LD	A,(D.61E3)
        LD	C,A
        LD	B,00H
        LD	HL,(GRPACX)
        ADD	HL,BC
        LD	(GRPACX),HL
        RET

J$4E44:	LD	HL,D.6320
        CALL	C.4F4D
        LD	A,(D.61E4)
        SRL	A
        LD	C,A
        LD	B,00H
        LD	HL,(GRPACY)
        PUSH	HL
        ADD	HL,BC
        LD	(GRPACY),HL
        LD	HL,I$6328
        CALL	C.4F4D
        LD	A,(D.61E3)
        LD	C,A
        LD	B,00H
J$4E66:	POP	HL
        LD	(GRPACY),HL
        LD	HL,(GRPACX)
        ADD	HL,BC
        LD	(GRPACX),HL
        RET

J$4E72:	LD	C,6
        DEFB    21H
J$4E75:	LD      C,12
        LD	HL,D.6320
        LD	DE,(GRPACY)
        PUSH	DE
        LD	A,(D.61E4)
        LD	B,A
J$4E83:	CALL	C$4E95
        PUSH	BC
        CALL	C.549E
        POP	BC
        CALL	Z,C$4E94
        INC	HL
        INC	DE
        DJNZ	J$4E83
        JR	J$4E66

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$4E94:	INC	HL

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$4E95:	LD	(GRPACY),DE
        PUSH	HL
        PUSH	DE
        PUSH	BC
        CALL	C$4EE2
        POP	BC
        PUSH	BC
        LD	H,1
        LD	L,C
        LD	D,C
        LD	A,(D.61D4)
        BIT	7,A
        LD	E,00H
        JR	Z,J$4EAF
        DEC	E
J$4EAF:	PUSH	DE
        LD	C,0B0H
        LD	A,(PATWRK+0)
        XOR	E
        RLCA
        RLCA
        PUSH	AF
        CALL	C$503D
        LD	BC,0ACH*256+17          ; 44, no auto increment
        CALL	C.5678                  ; write VDP register
        EI
        LD	HL,PATWRK+1
        LD	A,(D.61DA)
        ADD	A,3
        LD	C,A                     ; VDP indirect port
        POP	AF
        POP	DE
        LD	B,3
J$4ED0:	RLCA
        RLCA
        OUT	(C),A
        DJNZ	J$4EDB
        LD	A,(HL)
        XOR	E
        INC	HL
        LD	B,4
J$4EDB:	DEC	D
        JR	NZ,J$4ED0
        POP	BC
        POP	DE
        POP	HL
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$4EE2:	LD	A,(HL)
        LD	BC,16
        ADD	HL,BC
        LD	L,(HL)
        LD	H,A
        LD	DE,PATWRK
        LD	A,H
        PUSH	HL
        RRCA
        RRCA
        RRCA
        AND	1FH
        CALL	C$4F03
        POP	HL
        ADD	HL,HL
        PUSH	HL
        ADD	HL,HL
        ADD	HL,HL
        LD	A,H
        CALL	C$4F01
        POP	HL
        LD	A,L

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$4F01:	AND	3FH

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$4F03:	LD	HL,I$4F0D
        LD	C,A
        LD	B,00H
        ADD	HL,BC
        LDI
        RET

I$4F0D:	NOP
        INC	BC
        EX	AF,AF'
        DEC	BC
        EX	AF,AF'
        DEC	BC
        INC	C
        RRCA
        JR	NC,J$4F4A
        JR	C,J$4F54
        JR	C,J$4F56
        INC	A
        CCF
        ADD	A,B
        ADD	A,E
        ADC	A,B
        ADC	A,E
        ADC	A,B
        ADC	A,E
        ADC	A,H
        ADC	A,A
        OR	B
        OR	E
        CP	B
        CP	E
        CP	B
        CP	E
        CP	H
        CP	A
        ADD	A,B
        ADD	A,E
        ADC	A,B
        ADC	A,E
        ADC	A,B
        ADC	A,E
        ADC	A,H
        ADC	A,A
        OR	B
        OR	E
        CP	B
        CP	E
        CP	B
        CP	E
        CP	H
        CP	A
        RET	NZ
        JP	J$CBC8

?.4F41:	RET	Z
        SET	1,H
        RST	08H
        RET	P
        DI
        RET	M
        EI
        RET	M
J$4F4A:	EI
        CALL	M,C$11FF
C.4F4D	EQU	$-1
        LD	B,B
        CALL	M,C$0801
        NOP
        LDIR
J$4F54	EQU	$-1

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$4F55:	LD	C,0B0H
        CALL	C.56A5                  ; screen mode 2 ?
        JP	Z,J$5047                ; yep,
        LD	HL,PATWRK
        LD	(D.61E6),HL

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$4F63:	LD	HL,(D.61E6)
        CALL	C.55FC
        JP	NZ,C.4F80
        CALL	C.4F80
        LD	HL,(D.61E6)
        INC	HL
        LD	A,1
        LD	(DPPAGE),A
        CALL	C.4F80
        XOR	A
        LD	(DPPAGE),A
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.4F80:	LD	A,(GRPACY)
        LD	B,A
        LD	A,(D.61E4)
        LD	(D.61E5),A
        DEC	A
        ADD	A,B
        JP	NC,C.4FB1
        PUSH	HL
        LD	HL,(GRPACY)
        EX	(SP),HL
        INC	A
        PUSH	AF
        LD	B,A
        LD	A,(D.61E4)
        SUB	B
        LD	(D.61E5),A
        CALL	C.4FB1
        XOR	A
        LD	(GRPACY),A
        POP	AF
        LD	(D.61E5),A
        CALL	C.4FB1
        POP	HL
        LD	(GRPACY),HL
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.4FB1:	LD	DE,(D.61DF)
        PUSH	DE
        RL	(HL)
        JR	C,J$4FBB
        LD	E,D
J$4FBB:	PUSH	HL
        LD	A,(D.61E5)
        CALL	C$5064
        LD	BC,0ACH*256+17          ; 44, no auto increment
        CALL	C.5678                  ; write VDP register
        EI
        POP	HL
        POP	DE
        LD	A,(D.61DA)
        ADD	A,3
        LD	C,A                     ; VDP indirect port
        LD	IX,D.61E3
        LD	B,(IX+0)
        DEC	B
        LD	A,(D.61E5)
J$4FDC:	EX	AF,AF'
        LD	A,B
        SUB	07H
        AND	A
        LD	A,(HL)
        JP	Z,J$4FF6
        JP	P,J$4FEE
        JP	PE,J$4FFE
        JP	J$5006

J$4FEE:	ADD	A,A
        JR	C,J$4FF4
        OUT	(C),D
        DEFB    0DAH
J$4FF4:	OUT	(C),E
J$4FF6:	ADD	A,A
        JR	C,J$4FFC
        OUT	(C),D
        DEFB    0DAH
J$4FFC: OUT	(C),E
J$4FFE:	ADD	A,A
        JR	C,J$5004
        OUT	(C),D
        DEFB    0DAH
J$5004: OUT	(C),E
J$5006:	ADD	A,A
        JR	C,J$500C
        OUT	(C),D
        DEFB    0DAH
J$500C: OUT	(C),E
        ADD	A,A
        JR	C,J$5014
        OUT	(C),D
        DEFB    0DAH
J$5014: OUT	(C),E
        ADD	A,A
        JR	C,J$501C
        OUT	(C),D
        DEFB    0DAH
J$501C: OUT	(C),E
        ADD	A,A
        JR	C,J$5024
        OUT	(C),D
        DEFB    0DAH
J$5024: OUT	(C),E
        ADD	A,A
        JR	C,J$502C
        OUT	(C),D
        DEFB    0DAH
J$502C: OUT	(C),E
        INC	HL
        CALL	C.55FC
        JR	NZ,J$5035
        INC	HL
J$5035:	LD	B,(IX+0)
        EX	AF,AF'
        DEC	A
        JR	NZ,J$4FDC
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$503D:	PUSH	BC
        LD	E,A
        LD	D,00H
        PUSH	DE
        LD	E,H
        PUSH	DE
        LD	H,D
        JR	J$5055

J$5047:	LD	E,A
        CALL	C$50A2
        LD	D,0
        PUSH	BC
        PUSH	DE
        LD	E,A
        PUSH	DE
        LD	HL,(D.61E3)
        LD	H,D
J$5055:	PUSH	HL
        LD	HL,(GRPACY)
        CALL	C.5608                  ; get display page
        PUSH	HL
        LD	HL,(GRPACX)
        PUSH	HL
        JP	J$562A

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$5064:	EXX
        LD	H,A
        LD	DE,(GRPACX)
        LD	A,(D.61E3)
        LD	L,A
        CALL	C.5657                  ; wait for command ready
        LD	BC,24H*256+17           ; 36, auto increment
        CALL	C.5678                  ; write VDP register
        LD	A,(D.61DA)
        ADD	A,3
        LD	C,A                     ; VDP indirect port
        EXX
        LD	C,A                     ; VDP indirect port
        EXX
        OUT	(C),E
        OUT	(C),D
        LD	A,(GRPACY)
        OUT	(C),A
        LD	A,(DPPAGE)
        OUT	(C),A
        XOR	A
        OUT	(C),L
        OUT	(C),A
        OUT	(C),H
        OUT	(C),A
        EXX
        OUT	(C),E
        OUT	(C),A
        LD	A,0B0H
        OUT	(C),A
        EI
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$50A2:	LD	A,(D.61DC)
        AND	0FEH
        LD	A,(D.61E4)
        RET	Z
        RRA
        RET

;	  Subroutine copy system character pattern
;	     Inputs  ________________________
;	     Outputs ________________________

C.50AD:	ADD	HL,HL
        ADD	HL,HL
        ADD	HL,HL                   ; *8
        EX	DE,HL
        LD	HL,(CGPNT+1)
        ADD	HL,DE
        LD	DE,PATWRK
        LD	B,8
        LD	A,(CGPNT+0)
        OR	A                       ; default character set slotid ?
        JR	NZ,J$50C3               ; nope, use that slotid
        LD	A,(EXPTBL+0)            ; yep, use main-rom slotid
J$50C3:	LD	C,A
        LD	A,(EXPTBL+0)
        CP	C                       ; character set in main-rom ?
        JR	NZ,J$50D1               ; nope, use RDSLT
        LD	C,B
        LD	B,0
        LDIR                            ; copy character pattern
        JR	J$50E1

J$50D1:	LD	A,C                     ; slotid
J$50D2:	PUSH	AF
        PUSH	BC
        PUSH	DE
        CALL	RDSLT
        EI
        POP	DE
        LD	(DE),A
        INC	DE
        INC	HL
        POP	BC
        POP	AF
        DJNZ	J$50D2
J$50E1:	LD	A,(D.61D4)
        BIT	4,A
        RET	Z
        DEC	DE
        LD	A,0FFH
        LD	(DE),A
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.50EC:	LD	A,(D.61D3)
        RRCA
        RET	C
        CALL	C.5100
        CALL	C.549E
        RET	NZ
        CALL	C.5100
        XOR	A
        LD	(DPPAGE),A
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.5100:	LD	A,(GRPACY)
        LD	B,A
        LD	A,(D.61E4)
        LD	(D.61E5),A
        DEC	A
        ADD	A,B
        JP	NC,C.5130
        INC	A
        LD	HL,(GRPACY)
        PUSH	HL
        PUSH	AF
        LD	B,A
        LD	A,(D.61E4)
        SUB	B
        LD	(D.61E5),A
        CALL	C.5130
        XOR	A
        LD	(GRPACY),A
        POP	AF
        LD	(D.61E5),A
        CALL	C.5130
        POP	HL
        LD	(GRPACY),HL
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.5130:	CALL	C.56A5                  ; screen mode 2 ?
        JP	Z,J$517C                ; yep,
        EXX
        LD	D,83H
        LD	A,(D.61E1)
        LD	E,A
        EXX
        LD	DE,(GRPACX)
        CALL	C.5590
        LD	A,(D.61E5)
        LD	H,A
        CALL	C.5657                  ; wait for command ready
        LD	BC,24H*256+17           ; 36, auto increment
        CALL	C.5678                  ; write VDP register
        LD	A,(D.61DA)
        ADD	A,3
        LD	C,A                     ; VDP indirect port
        EXX
        LD	C,A                     ; VDP indirect port
        EXX
        OUT	(C),E
        OUT	(C),D
        LD	A,(GRPACY)
        OUT	(C),A
        LD	A,(DPPAGE)
        OUT	(C),A
        XOR	A
        OUT	(C),L
        OUT	(C),A
        OUT	(C),H
        OUT	(C),A
        EXX
        OUT	(C),E
        OUT	(C),A
        OUT	(C),D
        EXX
        EI
        RET

J$517C:	LD	C,83H
        PUSH	BC
        LD	A,(D.61E1)
        LD	E,A
        LD	D,00H
        PUSH	DE
        LD	HL,(D.61E5)
        LD	H,D
        PUSH	HL
        CALL	C.5590
        PUSH	HL
        LD	HL,(GRPACY)
        CALL	C.5608                  ; get display page
        PUSH	HL
        LD	HL,(GRPACX)
        PUSH	HL
        JP	J.5612

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$519D:	LD	D,A
        CALL	C$51A3
        JR	J$51DE

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$51A3:	CALL	C.56A5                  ; screen mode 2 ?
        LD	A,00H
        LD	B,D
        JP	Z,C.52B8                ; yep,
        CALL	C$5558
        XOR	A
        LD	E,A
        SUB	D
J$51B2:	CP	E
        JR	Z,J$51BB
        CALL	C.5373
        INC	A
        JR	J$51B2

J$51BB:	PUSH	DE
        LD	HL,D.61D7               ; number of rows
        LD	A,(CNSDFG)
        ADD	A,(HL)                  ; adjust if functionkey display enabled
        LD	E,A
        LD	A,(D.61D9)
        ADD	A,E
        LD	E,A
        SUB	D
        LD	D,A
        LD	A,(HL)
        CALL	C$5370
        POP	DE
        LD	A,D
        CALL	C.54FB
        LD	A,L
        NEG
        LD	L,A
        JR	C.5225

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.51DA:	LD	D,A
        CALL	C$51F1
J$51DE:	LD	HL,(CSRY)

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$51E1:	LD	H,00H
        CALL	C.55C0
        LD	(HL),00H
        LD	D,H
        LD	E,L
        INC	DE
        LD	BC,9
        LDIR
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$51F1:	CALL	C.56A5                  ; screen mode 2 ?
        LD	A,00H
        LD	B,D
        JP	Z,C.5299                ; yep,
        CALL	C$554D
        LD	BC,(D.61D7)             ; number of rows
        DEC	C
        LD	B,0
        LD	A,(CNSDFG)
        OR	A                       ; functionkey display enabled ?
        JR	NZ,J$523B               ; yep,
        LD	A,(D.61D9)
        OR	A
        JR	NZ,J$5241
        LD	A,(D.61D7)              ; number of rows
        LD	C,A
        ADD	A,D
        LD	E,A
        INC	E
        LD	A,C
J$5218:	CP	E
        JR	Z,J$5221
        CALL	C.5373
        INC	A
        JR	J$5218

J$5221:	LD	A,D
        CALL	C.54FB

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.5225:	CALL	C.5657                  ; wait for command ready
        LD	B,L
        LD	HL,GRPACY
        LD	A,(HL)
        ADD	A,B
        LD	(HL),A
        LD	A,(RG23SAV)
        ADD	A,B
        LD	B,A
        LD	C,23
        CALL	C.5678                  ; write VDP register
        EI
        RET

J$523B:	LD	A,(D.61D9)
        OR	A
        JR	NZ,J$5265
J$5241:	LD	A,(D.61D7)              ; number of rows
        LD	E,A
        DEC	E
        INC	A
        CALL	C.5373
        INC	A
        LD	D,A
        CALL	C.52E3
        LD	A,E
        CALL	C.5373
        LD	A,01H	; 1 
        CALL	C.54FB
        CALL	C.5225
        LD	A,(D.61D7)              ; number of rows
        LD	D,A
        DEC	D
        LD	E,A
        INC	E
        JP	C.52E3

J$5265:	LD	A,(D.61D7)              ; number of rows
        LD	E,A
        INC	A
        CALL	C.5373
        INC	A
        LD	D,A
        DEC	E
        DEC	E
        CALL	C.52E3
        INC	E
        INC	D
        CALL	C.52E3
        LD	A,E
        CALL	C.5373
        DEC	A
        CALL	C.5373
        LD	A,01H	; 1 
        CALL	C.54FB
        CALL	C.5225
        LD	A,(D.61D7)              ; number of rows
        LD	D,A
        DEC	D
        DEC	D
        LD	E,A
        INC	E
        CALL	C.52E3
        INC	E
        INC	D
        JP	C.52E3

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.5299:	LD	D,A
        ADD	A,B
        JR	NC,J$529E
        SBC	A,A
J$529E:	LD	E,A
        LD	HL,D.61D7               ; number of rows
        LD	A,(CNSDFG)
        ADD	A,(HL)                  ; adjust if functionkey display enabled
        LD	HL,D.61D9
        ADD	A,(HL)
        CALL	C.535D

;	  Subroutine clear screen (partly)
;	     Inputs  ________________________
;	     Outputs ________________________

C.52AD:	CP	E                       ; at last row ?
        RET	Z                       ; yep, quit
        CALL	C$5587
        CALL	C.5373
        INC	A                       ; update row
        JR	C.52AD                  ; next row

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.52B8:	LD	E,A
        ADD	A,B
        JR	NC,J$52BD
        SBC	A,A
J$52BD:	LD	D,A
        LD	HL,D.61D7               ; number of rows
        LD	A,(CNSDFG)
        ADD	A,(HL)                  ; adjust if functionkey display enabled
        LD	HL,D.61D9
        ADD	A,(HL)
        CP	D
        JR	NC,J$52CD
        LD	D,A
J$52CD:	SUB	D
        JR	Z,J$52DF
        LD	B,A
        ADD	A,D
        LD	D,A
        LD	A,E
        ADD	A,B
        LD	E,A
J$52D6:	DEC	D
        DEC	E
        PUSH	BC
        CALL	C.52E3
        POP	BC
        DJNZ	J$52D6
J$52DF:	LD	A,E
        LD	E,D
        JR	C.52AD                  ; clear screen (partly)

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.52E3:	PUSH	DE
        CALL	C$5563
        POP	DE
        PUSH	DE
        CALL	C.52FB
        POP	DE
        CALL	C.549E
        RET	NZ
        PUSH	DE
        CALL	C.52FB
        POP	DE
        XOR	A
        LD	(DPPAGE),A
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.52FB:	LD	A,D
        CALL	C.54E8
        LD	(D.61EB),HL
        CALL	C.5354
        PUSH	AF
        LD	A,E
        CALL	C.54E8
        LD	(D.61ED),HL
        CALL	C.5354
        JR	C,J.533F
        POP	AF
        PUSH	AF
        JR	C,J.533F
        POP	AF

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.5317:	LD	C,0E0H
        PUSH	BC
        LD	BC,0
        PUSH	BC
        LD	HL,(D.61E5)
        LD	H,B
        PUSH	HL
        PUSH	HL
        LD	HL,(D.61EB)
        PUSH	HL
        LD	A,(D.61E5)
        ADD	A,L
        LD	(D.61EB),A
        PUSH	BC
        LD	HL,(D.61ED)
        PUSH	HL
        LD	A,(D.61E5)
        ADD	A,L
        LD	(D.61ED),A
        PUSH	BC
        JP	J$560D

J.533F:	POP	BC
        INC	A
        PUSH	AF
        LD	B,A
        LD	A,(D.61E4)
        SUB	B
        LD	(D.61E5),A
        CALL	C.5317
        POP	AF
        LD	(D.61E5),A
        JP	C.5317

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.5354:	LD	A,(D.61E4)
        LD	(D.61E5),A
        DEC	A
        ADD	A,L
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.535D:	CP	E
        JR	NC,J$5361
        LD	E,A
J$5361:	SUB	E
        JR	Z,J$536E
        LD	B,A
J$5365:	PUSH	BC
        CALL	C.52E3
        POP	BC
        INC	D
        INC	E
        DJNZ	J$5365
J$536E:	LD	A,D
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$5370:	CALL	C.535D

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.5373:	PUSH	AF
        PUSH	DE
        LD	HL,(GRPACY)
        PUSH	HL
        CALL	C.54E8
        LD	(GRPACY),HL
        CALL	C$5389
        POP	HL
        LD	(GRPACY),HL
        POP	DE
        POP	AF
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$5389:	CALL	C.5398
        CALL	C.549E
        RET	NZ
        CALL	C.5398
        XOR	A
        LD	(DPPAGE),A
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.5398:	LD	A,(GRPACY)
        LD	B,A
        LD	A,(D.61E4)
        LD	(D.61E5),A
        DEC	A
        ADD	A,B
        JP	NC,C.53C8
        INC	A
        LD	HL,(GRPACY)
        PUSH	HL
        PUSH	AF
        LD	B,A
        LD	A,(D.61E4)
        SUB	B
        LD	(D.61E5),A
        CALL	C.53C8
        XOR	A
        LD	(GRPACY),A
        POP	AF
        LD	(D.61E5),A
        CALL	C.53C8
        POP	HL
        LD	(GRPACY),HL
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.53C8:	LD	C,0C0H
        PUSH	BC
        LD	BC,(D.61E2)
        LD	B,00H
        PUSH	BC
        LD	HL,(D.61E5)
        LD	H,B
        PUSH	HL
        CALL	C.53E8
        PUSH	HL
        LD	HL,(GRPACY)
        CALL	C.5608                  ; get display page
        PUSH	HL
        LD	C,00H
        PUSH	BC
        JP	J.5612

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.53E8:	PUSH	AF
        LD	HL,256
        LD	A,(SCRMOD)
        AND	06H
        CP	6
        JR	NZ,J$53F6
        ADD	HL,HL
J$53F6:	POP	AF
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$53F8:	PUSH	AF
        LD	A,83H
        LD	(D.61E9),A
        LD	A,(D.61E1)
        LD	(D.61EA),A
        POP	AF
        JR	J$5426

J$5407:	PUSH	AF
        LD	L,A
        LD	H,E
        CALL	C.55C0
        CPL
        LD	C,A
        LD	B,D
J$5410:	LD	A,(HL)
        AND	C
        LD	(HL),A
        RLC	C
        JR	C,J$5418
        INC	HL
J$5418:	DJNZ	J$5410
        LD	A,0C0H
        LD	(D.61E9),A
        LD	A,(D.61E2)
        LD	(D.61EA),A
        POP	AF
J$5426:	LD	HL,(GRPACY)
        PUSH	HL
        CALL	C.54E8
        LD	(GRPACY),HL
        CALL	C$5438
        POP	HL
        LD	(GRPACY),HL
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$5438:	PUSH	DE
        CALL	C.5449
        POP	DE
        CALL	C.549E
        RET	NZ
        CALL	C.5449
        XOR	A
        LD	(DPPAGE),A
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.5449:	LD	A,(GRPACY)
        LD	B,A
        LD	A,(D.61E4)
        LD	(D.61E5),A
        DEC	A
        ADD	A,B
        JP	NC,C.5479
        INC	A
        LD	HL,(GRPACY)
        PUSH	HL
        PUSH	AF
        LD	B,A
        LD	A,(D.61E4)
        SUB	B
        LD	(D.61E5),A
        CALL	C.5479
        XOR	A
        LD	(GRPACY),A
        POP	AF
        LD	(D.61E5),A
        CALL	C.5479
        POP	HL
        LD	(GRPACY),HL
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.5479:	LD	BC,(D.61E9)
        PUSH	BC
        LD	L,B
        LD	H,00H
        PUSH	HL
        LD	HL,(D.61E5)
        LD	H,00H
        PUSH	HL
        LD	L,D
        CALL	C.54D0
        PUSH	HL
        LD	HL,(GRPACY)
        CALL	C.5608                  ; get display page
        PUSH	HL
        PUSH	DE
        EX	DE,HL
        CALL	C.54C3
        POP	DE
        PUSH	HL
        JP	J.5612

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.549E:	LD	C,A
        CALL	C.55FC
        LD	A,C
        RET	NZ
        LD	A,1
        LD	(DPPAGE),A
        LD	A,C
        RET

J$54AB:	PUSH	HL
        CALL	C.55C0
        CALL	C.55B2
        POP	HL
        LD	E,H
        LD	A,L
        CALL	C.54E8
        LD	(GRPACY),HL
        EX	DE,HL
        CALL	C.54C3
        LD	(GRPACX),HL
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.54C3:	CALL	C.54D0
        PUSH	DE
        LD	DE,(D.61DD)
        LD	D,00H
        ADD	HL,DE
        POP	DE
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.54D0:	PUSH	AF
        LD	H,0
        LD	A,(D.61DC)
        CP	4
        JR	NC,J$54DD
        OR	A
        JR	NZ,J$54E3
J$54DD:	LD	A,L
        ADD	A,A
        ADD	A,L
        LD	L,A
        JR	J$54E5

J$54E3:	ADD	HL,HL
        ADD	HL,HL
J$54E5:	ADD	HL,HL
        POP	AF
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.54E8:	PUSH	AF
        CALL	C.54FB
        CALL	C.56A5                  ; screen mode 2 ?
        JR	Z,J$54F9                ; yep, quit
        LD	A,(RG23SAV)
        ADD	A,L
        LD	L,A
        CALL	C.5608                  ; get display page
J$54F9:	POP	AF
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.54FB:	LD	L,A
        LD	H,0
        LD	A,(D.61DC)
        CP	7
        JR	Z,J$5521
        CP	6
        JR	NZ,J$552F
        CALL	C.56A5                  ; screen mode 2 ?
        JR	Z,J.5537                ; yep,
        PUSH	BC
        LD	C,L
        LD	B,H
        ADD	HL,HL
        ADD	HL,BC
        ADD	HL,HL
        CALL	C.4A72
        JR	NC,J$551D
        ADD	HL,BC
        ADD	HL,HL
        POP	BC
        RET

J$551D:	ADD	HL,HL
        ADD	HL,BC
        POP	BC
        RET

J$5521:	CALL	C.4A72
        JR	C,J.5538
        PUSH	BC
        LD	C,L
        LD	B,H
        ADD	HL,HL
        ADD	HL,BC
        ADD	HL,HL
        ADD	HL,BC
        POP	BC
        RET

J$552F:	CP	04H	; 4 
        JR	Z,J.5537
        CP	02H	; 2 
        JR	NZ,J.5538
J.5537:	ADD	HL,HL
J.5538:	ADD	HL,HL
        ADD	HL,HL
        ADD	HL,HL
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$553C:	XOR	A
        LD	(D.61EF),A
        LD	HL,I.61F3
        LD	DE,I$61F4
        LD	BC,I$012B
        LD	(HL),A
        LDIR
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$554D:	LD	HL,D.61EF
        LD	A,(HL)
        ADD	A,D
        LD	(HL),A
        SUB	1EH
        RET	C
        LD	(HL),A
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$5558:	LD	HL,D.61EF
        LD	A,(HL)
        SUB	D
        LD	(HL),A
        ADD	A,1EH
        RET	NC
        LD	(HL),A
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$5563:	LD	HL,D.61D7               ; number of rows
        LD	A,(CNSDFG)
        ADD	A,(HL)                  ; adjust if functionkey display enabled
        LD	HL,D.61D9
        ADD	A,(HL)
        DEC	A
        CP	D
        RET	C
        CP	E
        RET	C
        LD	H,00H
        LD	L,D
        CALL	C.55C0
        PUSH	HL
        LD	H,00H
        LD	L,E
        CALL	C.55C0
        POP	DE
        LD	BC,10
        LDIR
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$5587:	PUSH	DE
        PUSH	AF
        LD	L,A
        CALL	C$51E1
        POP	AF
        POP	DE
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.5590:	CALL	C.55B9
        AND	(HL)
        LD	HL,(D.61E3)
        LD	H,00H
        RET	Z
        ADD	HL,HL
        RET

J$559C:	CALL	C.55B9
        LD	E,A
        OR	(HL)
        LD	(HL),A
        LD	A,E
        CALL	C$55AE
J.55A6:	CALL	C.55B9
        LD	E,A
        CPL
        AND	(HL)
        LD	(HL),A
        LD	A,E

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$55AE:	RLCA
        JR	NC,C.55B2
        INC	HL

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.55B2:	LD	(D.61F0),A
        LD	(D.61F1),HL
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.55B9:	LD	A,(D.61F0)
        LD	HL,(D.61F1)
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.55C0:	PUSH	BC
        PUSH	DE
        EX	DE,HL
        LD	A,D
        PUSH	AF
        AND	07H
        LD	C,A
        LD	B,00H
        LD	HL,I$55F4
        ADD	HL,BC
        LD	B,(HL)
        POP	AF
        XOR	C
        RRCA
        RRCA
        RRCA
        LD	C,A
        LD	A,(D.61EF)
        ADD	A,E
        CP	1EH
        JR	C,J$55DF
        SUB	1EH
J$55DF:	LD	L,A
        LD	H,0
        LD	E,L
        LD	D,H
        ADD	HL,HL
        ADD	HL,HL
        ADD	HL,DE
        ADD	HL,HL
        LD	DE,I.61F3
        ADD	HL,DE
        LD	E,C
        LD	D,0
        ADD	HL,DE
        LD	A,B
        POP	DE
        POP	BC
        RET

I$55F4: DEFB    01H,02H,04H,08H,10H,20H,40H,80H

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.55FC:	LD	A,(D.61DC)
        CP	3
        RET	Z
        CP	5
        RET	Z
        CP	7
        RET

;	  Subroutine get display page
;	     Inputs  ________________________
;	     Outputs ________________________

C.5608:	LD	A,(DPPAGE)
        LD	H,A
        RET

J$560D:	LD	BC,32*256+15
        JR	J$5615

J.5612:	LD	BC,36*256+11
J$5615:	CALL	C.56A5                  ; screen mode 2 ?
        JP	Z,J.56AB                ; yep,
        LD	HL,0
        ADD	HL,SP
        CALL	C.5640                  ; write VDP registers
        INC	HL
        LD	SP,HL
        RET

?.5625:	LD	BC,32*256+15
        JR	J$562D

J$562A:	LD	BC,36*256+11
J$562D:	CALL	C.56A5                  ; screen mode 2 ?
        JR	Z,J.56AB                ; yep,
        LD	HL,0
        ADD	HL,SP
        CALL	C.5640                  ; write VDP registers
        INC	HL
        LD	SP,HL
        XOR	A
        LD	(DPPAGE),A
        RET

;	  Subroutine write VDP registers
;	     Inputs  HL = source data, B = start register, C = number of registers
;	     Outputs ________________________

C.5640:	PUSH	BC
        CALL	C.5657                  ; wait for command ready
        POP	BC
        PUSH	BC
        LD	C,17
        CALL	C.5678                  ; write VDP register
        POP	BC
        LD	B,C
        LD	A,(D.61DA)
        ADD	A,3
        LD	C,A                     ; VDP indirect port
        OTIR
        EI
        RET

;	  Subroutine wait for command ready
;	     Inputs  ________________________
;	     Outputs ________________________

C.5657:	LD	BC,8FH*256+17           ; 15, no auto increment
        CALL	C.5678                  ; write VDP register
        EI
        LD	A,(D.61DA)
        ADD	A,3
        LD	C,A                     ; VDP indirect port
        LD	B,0
J$5666:	LD	A,2
        DI
        OUT	(C),A                   ; select VDP status register 2
        DEC	C
        DEC	C
        IN	A,(C)                   ; read VDP status register
        RRCA                            ; command executing ?
        INC	C
        INC	C
        EI
        OUT	(C),B                   ; select VDP status register 0
        JR	C,J$5666                ; yep, wait
        RET

;	  Subroutine write VDP register
;	     Inputs  C = register, B = data
;	     Outputs ________________________

C.5678:	PUSH	AF
        PUSH	HL
        LD	L,C
        SET	7,L
        LD	A,(D.61DA)
        LD	C,A
        INC	C                       ; VDP command port
        DI
        OUT	(C),B                   ; register data
        OUT	(C),L                   ; register number
        LD	A,L
        LD	HL,RG0SAV-80H
        CP	88H
        JR	C,J$5696
        CP	98H
        JR	NC,J$569C
        LD	HL,RG8SAV-88H
J$5696:	LD	C,A
        LD	A,B
        LD	B,0
        ADD	HL,BC
        LD	(HL),A
J$569C:	POP	HL
        POP	AF
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$569F:	LD	A,(D.61DC)
        CP	6
        RET	NZ

;	  Subroutine screen mode 2 ?
;	     Inputs  ________________________
;	     Outputs ________________________

C.56A5:	LD	A,(SCRMOD)
        CP	2
        RET

J.56AB:	LD	A,B
        CP	32
        JR	NZ,J$56B4
        CALL	C.56CC
        EX	DE,HL
J$56B4:	CALL	C.56CC
        LD	A,(D.61DA)
        LD	C,A                     ; VDP data read port
        LD	IY,0
        ADD	IY,SP
        LD	A,(IY+6)
        CALL	C$56DB
        POP	HL
        POP	HL
        POP	HL
        POP	HL
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.56CC:	POP	BC
        POP	HL
        LD	A,L
        POP	HL
        PUSH	BC
        ADD	HL,HL
        ADD	HL,HL
        ADD	HL,HL
        ADD	HL,HL
        ADD	HL,HL
        LD	C,A
        LD	B,0
        ADD	HL,BC
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$56DB:	CP	0E0H
        JR	NZ,J$5726
        EX	DE,HL
        PUSH	HL
        PUSH	DE
        PUSH	BC
        LD	BC,(GRPCGP)
        ADD	HL,BC
        EX	DE,HL
        ADD	HL,BC
        EX	DE,HL
        POP	BC
        CALL	C$56FB
        POP	DE
        POP	HL
        PUSH	BC
        LD	BC,(GRPCOL)
        ADD	HL,BC
        EX	DE,HL
        ADD	HL,BC
        EX	DE,HL
        POP	BC

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$56FB:	LD	B,(IY+2)
J$56FE:	PUSH	BC
        PUSH	HL
        CALL	C.588F                  ; setup VDP for VRAM read
        LD	B,32
        LD	HL,LINWRK
J$5708:	INI
        JR	NZ,J$5708
        EX	DE,HL
        CALL	C.588B                  ; setup VDP for VRAM write
        EX	DE,HL
        LD	B,32
        LD	HL,LINWRK
J$5716:	OUTI
        JR	NZ,J$5716
        POP	HL
        LD	BC,32
        ADD	HL,BC
        EX	DE,HL
        ADD	HL,BC
        EX	DE,HL
        POP	BC
        DJNZ	J$56FE
        RET

J$5726:	LD	D,A
        LD	A,(IY+2)
J$572A:	PUSH	AF
        PUSH	DE
        PUSH	HL
        CALL	C$573A
        POP	HL
        POP	DE
        POP	AF
        INC	H
        SUB	08H
        RET	C
        JR	NZ,J$572A
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$573A:	LD	A,L
        AND	07H	; 7 
        LD	E,A
        XOR	L
        CP	L
        LD	L,A
        LD	A,(IY+0)
        JR	Z,J$575B
        PUSH	AF
        PUSH	BC
        PUSH	DE
        PUSH	HL
        CALL	C$5779
        POP	HL
        POP	DE
        LD	BC,8
        ADD	HL,BC
        POP	BC
        POP	AF
        ADD	A,E
        DEC	A
        SUB	07H	; 7 
        RET	C
        RET	Z
J$575B:	DEC	A
        SUB	07H	; 7 
J$575E:	JR	C,J$5774
        PUSH	AF
        PUSH	BC
        PUSH	DE
        PUSH	HL
        LD	A,D
        CALL	C$5789
        POP	HL
        POP	DE
        LD	BC,8
        ADD	HL,BC
        POP	BC
        POP	AF
        SUB	08H	; 8 
        JR	J$575E

J$5774:	AND	07H	; 7 
        RET	Z
        LD	E,00H

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$5779:	CALL	C$5834
        CP	0C0H
        JR	Z,J$57A8
        CP	83H
        JR	Z,J$57C8
        CP	0B0H
        JR	Z,J$5807
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$5789:	CP	0C0H
        JR	Z,J$5796
        CP	83H
        JR	Z,J$57C6
        CP	0B0H
        JR	Z,J$57FA
        RET

J$5796:	PUSH	HL
        LD	DE,(GRPCGP)
        ADD	HL,DE
        CALL	C.588B                  ; setup VDP for VRAM write
        XOR	A
        LD	B,8
J$57A2:	OUT	(C),A
        DJNZ	J$57A2
        JR	J$57BB

J$57A8:	PUSH	HL
        CALL	C.5850
        CALL	C.588B                  ; setup VDP for VRAM write
        LD	B,8
        LD	HL,D.6320
J$57B4:	LD	A,(HL)
        AND	D
        OUT	(C),A
        INC	HL
        DJNZ	J$57B4
J$57BB:	POP	HL
        LD	DE,(GRPCOL)
        ADD	HL,DE
        LD	A,(IY+4)
        JR	J$57F0

J$57C6:	LD	E,0FFH
J$57C8:	PUSH	HL
        CALL	C.5850
        CALL	C.588B                  ; setup VDP for VRAM write
        LD	HL,D.6320
        LD	B,8
J$57D4:	LD	A,(HL)
        XOR	E
        OUT	(C),A
        INC	HL
        DJNZ	J$57D4
        POP	HL
        LD	DE,(GRPCOL)
        ADD	HL,DE
        CALL	C.588F                  ; setup VDP for VRAM read
        IN	A,(C)
        XOR	(IY+4)
        RLCA
        RLCA
        RLCA
        RLCA
        XOR	(IY+4)
J$57F0:	CALL	C.588B                  ; setup VDP for VRAM write
        LD	B,8
J$57F5:	OUT	(C),A
        DJNZ	J$57F5
        RET

J$57FA:	CALL	C.5866
        LD	B,8
        LD	HL,PATWRK
J$5802:	OUTI
        JR	NZ,J$5802
        RET

J$5807:	LD	A,B
        EXX
        LD	E,A
        EXX
        PUSH	HL
        CALL	C.5850
        POP	HL
        CALL	C.5866
        LD	HL,D.6320
        EXX
        LD	HL,PATWRK
        LD	C,8
J$581C:	LD	A,(HL)
        LD	B,E
        INC	B
J$581F:	RRCA
        DJNZ	J$581F
        RLCA
        LD	(HL),A
        INC	HL
        EXX
        AND	E
        LD	B,A
        LD	A,(HL)
        AND	D
        INC	HL
        OR	B
        OUT	(C),A
        EXX
        DEC	C
        JR	NZ,J$581C
        EXX
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C$5834:	DEC	A
        CP	07H	; 7 
        JR	C,J$583B
        LD	A,07H	; 7 
J$583B:	INC	A
        LD	B,A
        XOR	A
J$583E:	SCF
        RRA
        DJNZ	J$583E
        LD	B,E
        INC	B
J$5844:	OR	A
        RRA
        DJNZ	J$5844
        RLA
        LD	B,E
        PUSH	DE
        LD	E,A
        CPL
        LD	D,A
        POP	AF
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.5850:	PUSH	DE
        LD	DE,(GRPCGP)
        ADD	HL,DE
        POP	DE
        PUSH	HL
        CALL	C.588F                  ; setup VDP for VRAM read
        LD	B,8
        LD	HL,D.6320
J$5860:	INI
        JR	NZ,J$5860
        POP	HL
        RET

;	  Subroutine __________________________
;	     Inputs  ________________________
;	     Outputs ________________________

C.5866:	PUSH	HL
        PUSH	DE
        PUSH	BC
        LD	DE,(GRPCOL)
        ADD	HL,DE
        CALL	C.588B                  ; setup VDP for VRAM write
        LD	DE,(D.61DF)
        LD	A,E
        ADD	A,A
        ADD	A,A
        ADD	A,A
        ADD	A,A
        OR	D
        LD	B,8
J$587D:	OUT	(C),A
        DJNZ	J$587D
        POP	BC
        POP	DE
        POP	HL
        PUSH	DE
        LD	DE,(GRPCGP)
        ADD	HL,DE
        POP	DE

;	  Subroutine setup VDP for VRAM write
;	     Inputs  ________________________
;	     Outputs ________________________

C.588B:	SET	6,H
        JR	J$5891

;	  Subroutine setup VDP for VRAM read
;	     Inputs  ________________________
;	     Outputs ________________________

C.588F:	RES	6,H
J$5891:	RES	7,H
        INC	C
        DI
        OUT	(C),L
        EI
        OUT	(C),H
        DEC	C
        EX	(SP),HL
        EX	(SP),HL
        RET

J$589E:	PUSH	AF
        CALL	C.58E3                  ; send or print embedded string
        DEFB    27,"[?1;0;0012;",0
        LD	A,(EXBRSA)
        OR	A                       ; MSX1 ?
        LD	A,1
        JR	Z,J$58B9                ; yep,
        LD	A,2
J$58B9:	CALL	C.58EE                  ; send or print as ASCII digits + ';'
        POP	AF
        CALL	C.58EE                  ; send or print as ASCII digits + ';'
        LD	A,H
        CALL	C.58EE                  ; send or print as ASCII digits + ';'
        LD	A,L
        CALL	C.58EE                  ; send or print as ASCII digits + ';'
        CALL	C.58E3                  ; send or print embedded string
        DEFB    "004c",0
        RET

J$58D1:	CALL	C.58E3                  ; send or print embedded string
        DEFB    27,"[",0
        LD	A,L
        CALL	C.58EE                  ; send or print as ASCII digits + ';'
J$58DB:	LD	A,H
        CALL	C.58F5                  ; send or print as ASCII digits
        LD	A,"R"
        JR	C.5907                  ; send or print byte

;	  Subroutine send or print embedded string
;	     Inputs  ________________________
;	     Outputs ________________________

C.58E3:	EX	(SP),HL
        LD	A,(HL)
        INC	HL
        EX	(SP),HL
        OR	A
        RET	Z
        CALL	C.5907                  ; send or print byte
        JR	C.58E3

;	  Subroutine send or print as ASCII digits + ';'
;	     Inputs  ________________________
;	     Outputs ________________________

C.58EE:	CALL	C.58F5                  ; send or print as ASCII digits
        LD	A,";"
        JR	C.5907                  ; send or print byte

;	  Subroutine send or print as ASCII digits
;	     Inputs  ________________________
;	     Outputs ________________________

C.58F5:	LD	B,0
J$58F7:	INC	B
        SUB	10
        JR	NC,J$58F7
        ADD	A,10
        DEC	B
        PUSH	AF
        LD	A,B
        CALL	NZ,C.58F5               ; send or print as ASCII digits
        POP	AF
        ADD	A,"0"

;	  Subroutine send or print byte
;	     Inputs  ________________________
;	     Outputs ________________________

C.5907:	PUSH	HL
        CALL	C$6000
        DEFB	1
        DEFW	C.40A2                  ; send or print byte
        POP	HL
        RET

?.5910:	RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
J.59ED:	RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        END
	RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	38H
        RST	3
